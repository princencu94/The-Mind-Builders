{"ast":null,"code":"import { extends as _extends, objectWithoutPropertiesLoose as _objectWithoutPropertiesLoose } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport React, { useReducer, createRef, useMemo, createContext, useCallback, useRef, useContext, Fragment } from 'react';\nimport { match } from '../../utils/match.esm.js';\nimport { render, forwardRefWithAs, Features } from '../../utils/render.esm.js';\nimport { useSyncRefs } from '../../hooks/use-sync-refs.esm.js';\nimport { Keys } from '../keyboard.esm.js';\nimport { isDisabledReactIssue7711 } from '../../utils/bugs.esm.js';\nimport { useIsoMorphicEffect } from '../../hooks/use-iso-morphic-effect.esm.js';\nimport { useId } from '../../hooks/use-id.esm.js';\nimport { isFocusableElement, FocusableMode } from '../../utils/focus-management.esm.js';\nimport { useWindowEvent } from '../../hooks/use-window-event.esm.js';\nimport { OpenClosedProvider, State, useOpenClosed } from '../../internal/open-closed.esm.js';\nimport { useResolveButtonType } from '../../hooks/use-resolve-button-type.esm.js';\nimport { disposables } from '../../utils/disposables.esm.js';\nimport { useDisposables } from '../../hooks/use-disposables.esm.js';\nimport { useComputed } from '../../hooks/use-computed.esm.js';\nimport { calculateActiveIndex, Focus } from '../../utils/calculate-active-index.esm.js';\n\nvar _reducers;\n\nvar ListboxStates;\n\n(function (ListboxStates) {\n  ListboxStates[ListboxStates[\"Open\"] = 0] = \"Open\";\n  ListboxStates[ListboxStates[\"Closed\"] = 1] = \"Closed\";\n})(ListboxStates || (ListboxStates = {}));\n\nvar ActionTypes;\n\n(function (ActionTypes) {\n  ActionTypes[ActionTypes[\"OpenListbox\"] = 0] = \"OpenListbox\";\n  ActionTypes[ActionTypes[\"CloseListbox\"] = 1] = \"CloseListbox\";\n  ActionTypes[ActionTypes[\"SetDisabled\"] = 2] = \"SetDisabled\";\n  ActionTypes[ActionTypes[\"SetOrientation\"] = 3] = \"SetOrientation\";\n  ActionTypes[ActionTypes[\"GoToOption\"] = 4] = \"GoToOption\";\n  ActionTypes[ActionTypes[\"Search\"] = 5] = \"Search\";\n  ActionTypes[ActionTypes[\"ClearSearch\"] = 6] = \"ClearSearch\";\n  ActionTypes[ActionTypes[\"RegisterOption\"] = 7] = \"RegisterOption\";\n  ActionTypes[ActionTypes[\"UnregisterOption\"] = 8] = \"UnregisterOption\";\n})(ActionTypes || (ActionTypes = {}));\n\nvar reducers = (_reducers = {}, _reducers[ActionTypes.CloseListbox] = function (state) {\n  if (state.disabled) return state;\n  if (state.listboxState === ListboxStates.Closed) return state;\n  return _extends({}, state, {\n    activeOptionIndex: null,\n    listboxState: ListboxStates.Closed\n  });\n}, _reducers[ActionTypes.OpenListbox] = function (state) {\n  if (state.disabled) return state;\n  if (state.listboxState === ListboxStates.Open) return state;\n  return _extends({}, state, {\n    listboxState: ListboxStates.Open\n  });\n}, _reducers[ActionTypes.SetDisabled] = function (state, action) {\n  if (state.disabled === action.disabled) return state;\n  return _extends({}, state, {\n    disabled: action.disabled\n  });\n}, _reducers[ActionTypes.SetOrientation] = function (state, action) {\n  if (state.orientation === action.orientation) return state;\n  return _extends({}, state, {\n    orientation: action.orientation\n  });\n}, _reducers[ActionTypes.GoToOption] = function (state, action) {\n  if (state.disabled) return state;\n  if (state.listboxState === ListboxStates.Closed) return state;\n  var activeOptionIndex = calculateActiveIndex(action, {\n    resolveItems: function resolveItems() {\n      return state.options;\n    },\n    resolveActiveIndex: function resolveActiveIndex() {\n      return state.activeOptionIndex;\n    },\n    resolveId: function resolveId(item) {\n      return item.id;\n    },\n    resolveDisabled: function resolveDisabled(item) {\n      return item.dataRef.current.disabled;\n    }\n  });\n  if (state.searchQuery === '' && state.activeOptionIndex === activeOptionIndex) return state;\n  return _extends({}, state, {\n    searchQuery: '',\n    activeOptionIndex: activeOptionIndex\n  });\n}, _reducers[ActionTypes.Search] = function (state, action) {\n  if (state.disabled) return state;\n  if (state.listboxState === ListboxStates.Closed) return state;\n  var searchQuery = state.searchQuery + action.value.toLowerCase();\n  var match = state.options.findIndex(function (option) {\n    var _option$dataRef$curre;\n\n    return !option.dataRef.current.disabled && ((_option$dataRef$curre = option.dataRef.current.textValue) == null ? void 0 : _option$dataRef$curre.startsWith(searchQuery));\n  });\n  if (match === -1 || match === state.activeOptionIndex) return _extends({}, state, {\n    searchQuery: searchQuery\n  });\n  return _extends({}, state, {\n    searchQuery: searchQuery,\n    activeOptionIndex: match\n  });\n}, _reducers[ActionTypes.ClearSearch] = function (state) {\n  if (state.disabled) return state;\n  if (state.listboxState === ListboxStates.Closed) return state;\n  if (state.searchQuery === '') return state;\n  return _extends({}, state, {\n    searchQuery: ''\n  });\n}, _reducers[ActionTypes.RegisterOption] = function (state, action) {\n  return _extends({}, state, {\n    options: [].concat(state.options, [{\n      id: action.id,\n      dataRef: action.dataRef\n    }])\n  });\n}, _reducers[ActionTypes.UnregisterOption] = function (state, action) {\n  var nextOptions = state.options.slice();\n  var currentActiveOption = state.activeOptionIndex !== null ? nextOptions[state.activeOptionIndex] : null;\n  var idx = nextOptions.findIndex(function (a) {\n    return a.id === action.id;\n  });\n  if (idx !== -1) nextOptions.splice(idx, 1);\n  return _extends({}, state, {\n    options: nextOptions,\n    activeOptionIndex: function () {\n      if (idx === state.activeOptionIndex) return null;\n      if (currentActiveOption === null) return null; // If we removed the option before the actual active index, then it would be out of sync. To\n      // fix this, we will find the correct (new) index position.\n\n      return nextOptions.indexOf(currentActiveOption);\n    }()\n  });\n}, _reducers);\nvar ListboxContext = /*#__PURE__*/createContext(null);\nListboxContext.displayName = 'ListboxContext';\n\nfunction useListboxContext(component) {\n  var context = useContext(ListboxContext);\n\n  if (context === null) {\n    var err = new Error(\"<\" + component + \" /> is missing a parent <\" + Listbox.name + \" /> component.\");\n    if (Error.captureStackTrace) Error.captureStackTrace(err, useListboxContext);\n    throw err;\n  }\n\n  return context;\n}\n\nfunction stateReducer(state, action) {\n  return match(action.type, reducers, state, action);\n} // ---\n\n\nvar DEFAULT_LISTBOX_TAG = Fragment;\n\nfunction Listbox(props) {\n  var _match;\n\n  var value = props.value,\n      onChange = props.onChange,\n      _props$disabled = props.disabled,\n      disabled = _props$disabled === void 0 ? false : _props$disabled,\n      _props$horizontal = props.horizontal,\n      horizontal = _props$horizontal === void 0 ? false : _props$horizontal,\n      passThroughProps = _objectWithoutPropertiesLoose(props, [\"value\", \"onChange\", \"disabled\", \"horizontal\"]);\n\n  var orientation = horizontal ? 'horizontal' : 'vertical';\n  var reducerBag = useReducer(stateReducer, {\n    listboxState: ListboxStates.Closed,\n    propsRef: {\n      current: {\n        value: value,\n        onChange: onChange\n      }\n    },\n    labelRef: createRef(),\n    buttonRef: createRef(),\n    optionsRef: createRef(),\n    disabled: disabled,\n    orientation: orientation,\n    options: [],\n    searchQuery: '',\n    activeOptionIndex: null\n  });\n  var _reducerBag$ = reducerBag[0],\n      listboxState = _reducerBag$.listboxState,\n      propsRef = _reducerBag$.propsRef,\n      optionsRef = _reducerBag$.optionsRef,\n      buttonRef = _reducerBag$.buttonRef,\n      dispatch = reducerBag[1];\n  useIsoMorphicEffect(function () {\n    propsRef.current.value = value;\n  }, [value, propsRef]);\n  useIsoMorphicEffect(function () {\n    propsRef.current.onChange = onChange;\n  }, [onChange, propsRef]);\n  useIsoMorphicEffect(function () {\n    return dispatch({\n      type: ActionTypes.SetDisabled,\n      disabled: disabled\n    });\n  }, [disabled]);\n  useIsoMorphicEffect(function () {\n    return dispatch({\n      type: ActionTypes.SetOrientation,\n      orientation: orientation\n    });\n  }, [orientation]); // Handle outside click\n\n  useWindowEvent('mousedown', function (event) {\n    var _buttonRef$current, _optionsRef$current;\n\n    var target = event.target;\n    if (listboxState !== ListboxStates.Open) return;\n    if ((_buttonRef$current = buttonRef.current) == null ? void 0 : _buttonRef$current.contains(target)) return;\n    if ((_optionsRef$current = optionsRef.current) == null ? void 0 : _optionsRef$current.contains(target)) return;\n    dispatch({\n      type: ActionTypes.CloseListbox\n    });\n\n    if (!isFocusableElement(target, FocusableMode.Loose)) {\n      var _buttonRef$current2;\n\n      event.preventDefault();\n      (_buttonRef$current2 = buttonRef.current) == null ? void 0 : _buttonRef$current2.focus();\n    }\n  });\n  var slot = useMemo(function () {\n    return {\n      open: listboxState === ListboxStates.Open,\n      disabled: disabled\n    };\n  }, [listboxState, disabled]);\n  return React.createElement(ListboxContext.Provider, {\n    value: reducerBag\n  }, React.createElement(OpenClosedProvider, {\n    value: match(listboxState, (_match = {}, _match[ListboxStates.Open] = State.Open, _match[ListboxStates.Closed] = State.Closed, _match))\n  }, render({\n    props: passThroughProps,\n    slot: slot,\n    defaultTag: DEFAULT_LISTBOX_TAG,\n    name: 'Listbox'\n  })));\n} // ---\n\n\nvar DEFAULT_BUTTON_TAG = 'button';\nvar Button = /*#__PURE__*/forwardRefWithAs(function Button(props, ref) {\n  var _state$optionsRef$cur;\n\n  var _useListboxContext = useListboxContext([Listbox.name, Button.name].join('.')),\n      state = _useListboxContext[0],\n      dispatch = _useListboxContext[1];\n\n  var buttonRef = useSyncRefs(state.buttonRef, ref);\n  var id = \"headlessui-listbox-button-\" + useId();\n  var d = useDisposables();\n  var handleKeyDown = useCallback(function (event) {\n    switch (event.key) {\n      // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-13\n      case Keys.Space:\n      case Keys.Enter:\n      case Keys.ArrowDown:\n        event.preventDefault();\n        dispatch({\n          type: ActionTypes.OpenListbox\n        });\n        d.nextFrame(function () {\n          if (!state.propsRef.current.value) dispatch({\n            type: ActionTypes.GoToOption,\n            focus: Focus.First\n          });\n        });\n        break;\n\n      case Keys.ArrowUp:\n        event.preventDefault();\n        dispatch({\n          type: ActionTypes.OpenListbox\n        });\n        d.nextFrame(function () {\n          if (!state.propsRef.current.value) dispatch({\n            type: ActionTypes.GoToOption,\n            focus: Focus.Last\n          });\n        });\n        break;\n    }\n  }, [dispatch, state, d]);\n  var handleKeyUp = useCallback(function (event) {\n    switch (event.key) {\n      case Keys.Space:\n        // Required for firefox, event.preventDefault() in handleKeyDown for\n        // the Space key doesn't cancel the handleKeyUp, which in turn\n        // triggers a *click*.\n        event.preventDefault();\n        break;\n    }\n  }, []);\n  var handleClick = useCallback(function (event) {\n    if (isDisabledReactIssue7711(event.currentTarget)) return event.preventDefault();\n\n    if (state.listboxState === ListboxStates.Open) {\n      dispatch({\n        type: ActionTypes.CloseListbox\n      });\n      d.nextFrame(function () {\n        var _state$buttonRef$curr;\n\n        return (_state$buttonRef$curr = state.buttonRef.current) == null ? void 0 : _state$buttonRef$curr.focus({\n          preventScroll: true\n        });\n      });\n    } else {\n      event.preventDefault();\n      dispatch({\n        type: ActionTypes.OpenListbox\n      });\n    }\n  }, [dispatch, d, state]);\n  var labelledby = useComputed(function () {\n    if (!state.labelRef.current) return undefined;\n    return [state.labelRef.current.id, id].join(' ');\n  }, [state.labelRef.current, id]);\n  var slot = useMemo(function () {\n    return {\n      open: state.listboxState === ListboxStates.Open,\n      disabled: state.disabled\n    };\n  }, [state]);\n  var passthroughProps = props;\n  var propsWeControl = {\n    ref: buttonRef,\n    id: id,\n    type: useResolveButtonType(props, state.buttonRef),\n    'aria-haspopup': true,\n    'aria-controls': (_state$optionsRef$cur = state.optionsRef.current) == null ? void 0 : _state$optionsRef$cur.id,\n    'aria-expanded': state.disabled ? undefined : state.listboxState === ListboxStates.Open,\n    'aria-labelledby': labelledby,\n    disabled: state.disabled,\n    onKeyDown: handleKeyDown,\n    onKeyUp: handleKeyUp,\n    onClick: handleClick\n  };\n  return render({\n    props: _extends({}, passthroughProps, propsWeControl),\n    slot: slot,\n    defaultTag: DEFAULT_BUTTON_TAG,\n    name: 'Listbox.Button'\n  });\n}); // ---\n\nvar DEFAULT_LABEL_TAG = 'label';\n\nfunction Label(props) {\n  var _useListboxContext2 = useListboxContext([Listbox.name, Label.name].join('.')),\n      state = _useListboxContext2[0];\n\n  var id = \"headlessui-listbox-label-\" + useId();\n  var handleClick = useCallback(function () {\n    var _state$buttonRef$curr2;\n\n    return (_state$buttonRef$curr2 = state.buttonRef.current) == null ? void 0 : _state$buttonRef$curr2.focus({\n      preventScroll: true\n    });\n  }, [state.buttonRef]);\n  var slot = useMemo(function () {\n    return {\n      open: state.listboxState === ListboxStates.Open,\n      disabled: state.disabled\n    };\n  }, [state]);\n  var propsWeControl = {\n    ref: state.labelRef,\n    id: id,\n    onClick: handleClick\n  };\n  return render({\n    props: _extends({}, props, propsWeControl),\n    slot: slot,\n    defaultTag: DEFAULT_LABEL_TAG,\n    name: 'Listbox.Label'\n  });\n} // ---\n\n\nvar DEFAULT_OPTIONS_TAG = 'ul';\nvar OptionsRenderFeatures = Features.RenderStrategy | Features.Static;\nvar Options = /*#__PURE__*/forwardRefWithAs(function Options(props, ref) {\n  var _state$options$state$;\n\n  var _useListboxContext3 = useListboxContext([Listbox.name, Options.name].join('.')),\n      state = _useListboxContext3[0],\n      dispatch = _useListboxContext3[1];\n\n  var optionsRef = useSyncRefs(state.optionsRef, ref);\n  var id = \"headlessui-listbox-options-\" + useId();\n  var d = useDisposables();\n  var searchDisposables = useDisposables();\n  var usesOpenClosedState = useOpenClosed();\n\n  var visible = function () {\n    if (usesOpenClosedState !== null) {\n      return usesOpenClosedState === State.Open;\n    }\n\n    return state.listboxState === ListboxStates.Open;\n  }();\n\n  useIsoMorphicEffect(function () {\n    var container = state.optionsRef.current;\n    if (!container) return;\n    if (state.listboxState !== ListboxStates.Open) return;\n    if (container === document.activeElement) return;\n    container.focus({\n      preventScroll: true\n    });\n  }, [state.listboxState, state.optionsRef]);\n  var handleKeyDown = useCallback(function (event) {\n    searchDisposables.dispose();\n\n    switch (event.key) {\n      // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-12\n      // @ts-expect-error Fallthrough is expected here\n      case Keys.Space:\n        if (state.searchQuery !== '') {\n          event.preventDefault();\n          event.stopPropagation();\n          return dispatch({\n            type: ActionTypes.Search,\n            value: event.key\n          });\n        }\n\n      // When in type ahead mode, fallthrough\n\n      case Keys.Enter:\n        event.preventDefault();\n        event.stopPropagation();\n        dispatch({\n          type: ActionTypes.CloseListbox\n        });\n\n        if (state.activeOptionIndex !== null) {\n          var dataRef = state.options[state.activeOptionIndex].dataRef;\n          state.propsRef.current.onChange(dataRef.current.value);\n        }\n\n        disposables().nextFrame(function () {\n          var _state$buttonRef$curr3;\n\n          return (_state$buttonRef$curr3 = state.buttonRef.current) == null ? void 0 : _state$buttonRef$curr3.focus({\n            preventScroll: true\n          });\n        });\n        break;\n\n      case match(state.orientation, {\n        vertical: Keys.ArrowDown,\n        horizontal: Keys.ArrowRight\n      }):\n        event.preventDefault();\n        event.stopPropagation();\n        return dispatch({\n          type: ActionTypes.GoToOption,\n          focus: Focus.Next\n        });\n\n      case match(state.orientation, {\n        vertical: Keys.ArrowUp,\n        horizontal: Keys.ArrowLeft\n      }):\n        event.preventDefault();\n        event.stopPropagation();\n        return dispatch({\n          type: ActionTypes.GoToOption,\n          focus: Focus.Previous\n        });\n\n      case Keys.Home:\n      case Keys.PageUp:\n        event.preventDefault();\n        event.stopPropagation();\n        return dispatch({\n          type: ActionTypes.GoToOption,\n          focus: Focus.First\n        });\n\n      case Keys.End:\n      case Keys.PageDown:\n        event.preventDefault();\n        event.stopPropagation();\n        return dispatch({\n          type: ActionTypes.GoToOption,\n          focus: Focus.Last\n        });\n\n      case Keys.Escape:\n        event.preventDefault();\n        event.stopPropagation();\n        dispatch({\n          type: ActionTypes.CloseListbox\n        });\n        return d.nextFrame(function () {\n          var _state$buttonRef$curr4;\n\n          return (_state$buttonRef$curr4 = state.buttonRef.current) == null ? void 0 : _state$buttonRef$curr4.focus({\n            preventScroll: true\n          });\n        });\n\n      case Keys.Tab:\n        event.preventDefault();\n        event.stopPropagation();\n        break;\n\n      default:\n        if (event.key.length === 1) {\n          dispatch({\n            type: ActionTypes.Search,\n            value: event.key\n          });\n          searchDisposables.setTimeout(function () {\n            return dispatch({\n              type: ActionTypes.ClearSearch\n            });\n          }, 350);\n        }\n\n        break;\n    }\n  }, [d, dispatch, searchDisposables, state]);\n  var labelledby = useComputed(function () {\n    var _state$labelRef$curre, _state$labelRef$curre2, _state$buttonRef$curr5;\n\n    return (_state$labelRef$curre = (_state$labelRef$curre2 = state.labelRef.current) == null ? void 0 : _state$labelRef$curre2.id) != null ? _state$labelRef$curre : (_state$buttonRef$curr5 = state.buttonRef.current) == null ? void 0 : _state$buttonRef$curr5.id;\n  }, [state.labelRef.current, state.buttonRef.current]);\n  var slot = useMemo(function () {\n    return {\n      open: state.listboxState === ListboxStates.Open\n    };\n  }, [state]);\n  var propsWeControl = {\n    'aria-activedescendant': state.activeOptionIndex === null ? undefined : (_state$options$state$ = state.options[state.activeOptionIndex]) == null ? void 0 : _state$options$state$.id,\n    'aria-labelledby': labelledby,\n    'aria-orientation': state.orientation,\n    id: id,\n    onKeyDown: handleKeyDown,\n    role: 'listbox',\n    tabIndex: 0,\n    ref: optionsRef\n  };\n  var passthroughProps = props;\n  return render({\n    props: _extends({}, passthroughProps, propsWeControl),\n    slot: slot,\n    defaultTag: DEFAULT_OPTIONS_TAG,\n    features: OptionsRenderFeatures,\n    visible: visible,\n    name: 'Listbox.Options'\n  });\n}); // ---\n\nvar DEFAULT_OPTION_TAG = 'li';\n\nfunction Option(props) {\n  var _props$disabled2 = props.disabled,\n      disabled = _props$disabled2 === void 0 ? false : _props$disabled2,\n      value = props.value,\n      passthroughProps = _objectWithoutPropertiesLoose(props, [\"disabled\", \"value\"]);\n\n  var _useListboxContext4 = useListboxContext([Listbox.name, Option.name].join('.')),\n      state = _useListboxContext4[0],\n      dispatch = _useListboxContext4[1];\n\n  var id = \"headlessui-listbox-option-\" + useId();\n  var active = state.activeOptionIndex !== null ? state.options[state.activeOptionIndex].id === id : false;\n  var selected = state.propsRef.current.value === value;\n  var bag = useRef({\n    disabled: disabled,\n    value: value\n  });\n  useIsoMorphicEffect(function () {\n    bag.current.disabled = disabled;\n  }, [bag, disabled]);\n  useIsoMorphicEffect(function () {\n    bag.current.value = value;\n  }, [bag, value]);\n  useIsoMorphicEffect(function () {\n    var _document$getElementB, _document$getElementB2;\n\n    bag.current.textValue = (_document$getElementB = document.getElementById(id)) == null ? void 0 : (_document$getElementB2 = _document$getElementB.textContent) == null ? void 0 : _document$getElementB2.toLowerCase();\n  }, [bag, id]);\n  var select = useCallback(function () {\n    return state.propsRef.current.onChange(value);\n  }, [state.propsRef, value]);\n  useIsoMorphicEffect(function () {\n    dispatch({\n      type: ActionTypes.RegisterOption,\n      id: id,\n      dataRef: bag\n    });\n    return function () {\n      return dispatch({\n        type: ActionTypes.UnregisterOption,\n        id: id\n      });\n    };\n  }, [bag, id]);\n  useIsoMorphicEffect(function () {\n    var _document$getElementB3;\n\n    if (state.listboxState !== ListboxStates.Open) return;\n    if (!selected) return;\n    dispatch({\n      type: ActionTypes.GoToOption,\n      focus: Focus.Specific,\n      id: id\n    });\n    (_document$getElementB3 = document.getElementById(id)) == null ? void 0 : _document$getElementB3.focus == null ? void 0 : _document$getElementB3.focus();\n  }, [state.listboxState]);\n  useIsoMorphicEffect(function () {\n    if (state.listboxState !== ListboxStates.Open) return;\n    if (!active) return;\n    var d = disposables();\n    d.nextFrame(function () {\n      var _document$getElementB4;\n\n      return (_document$getElementB4 = document.getElementById(id)) == null ? void 0 : _document$getElementB4.scrollIntoView == null ? void 0 : _document$getElementB4.scrollIntoView({\n        block: 'nearest'\n      });\n    });\n    return d.dispose;\n  }, [id, active, state.listboxState]);\n  var handleClick = useCallback(function (event) {\n    if (disabled) return event.preventDefault();\n    select();\n    dispatch({\n      type: ActionTypes.CloseListbox\n    });\n    disposables().nextFrame(function () {\n      var _state$buttonRef$curr6;\n\n      return (_state$buttonRef$curr6 = state.buttonRef.current) == null ? void 0 : _state$buttonRef$curr6.focus({\n        preventScroll: true\n      });\n    });\n  }, [dispatch, state.buttonRef, disabled, select]);\n  var handleFocus = useCallback(function () {\n    if (disabled) return dispatch({\n      type: ActionTypes.GoToOption,\n      focus: Focus.Nothing\n    });\n    dispatch({\n      type: ActionTypes.GoToOption,\n      focus: Focus.Specific,\n      id: id\n    });\n  }, [disabled, id, dispatch]);\n  var handleMove = useCallback(function () {\n    if (disabled) return;\n    if (active) return;\n    dispatch({\n      type: ActionTypes.GoToOption,\n      focus: Focus.Specific,\n      id: id\n    });\n  }, [disabled, active, id, dispatch]);\n  var handleLeave = useCallback(function () {\n    if (disabled) return;\n    if (!active) return;\n    dispatch({\n      type: ActionTypes.GoToOption,\n      focus: Focus.Nothing\n    });\n  }, [disabled, active, dispatch]);\n  var slot = useMemo(function () {\n    return {\n      active: active,\n      selected: selected,\n      disabled: disabled\n    };\n  }, [active, selected, disabled]);\n  var propsWeControl = {\n    id: id,\n    role: 'option',\n    tabIndex: disabled === true ? undefined : -1,\n    'aria-disabled': disabled === true ? true : undefined,\n    'aria-selected': selected === true ? true : undefined,\n    disabled: undefined,\n    onClick: handleClick,\n    onFocus: handleFocus,\n    onPointerMove: handleMove,\n    onMouseMove: handleMove,\n    onPointerLeave: handleLeave,\n    onMouseLeave: handleLeave\n  };\n  return render({\n    props: _extends({}, passthroughProps, propsWeControl),\n    slot: slot,\n    defaultTag: DEFAULT_OPTION_TAG,\n    name: 'Listbox.Option'\n  });\n} // ---\n\n\nListbox.Button = Button;\nListbox.Label = Label;\nListbox.Options = Options;\nListbox.Option = Option;\nexport { Listbox };","map":{"version":3,"sources":["../../../src/components/listbox/listbox.tsx"],"names":["ListboxStates","ActionTypes","reducers","state","activeOptionIndex","listboxState","Closed","Open","action","disabled","orientation","calculateActiveIndex","resolveItems","resolveActiveIndex","resolveId","item","resolveDisabled","searchQuery","match","option","options","id","dataRef","nextOptions","currentActiveOption","idx","a","ListboxContext","createContext","context","useContext","err","Listbox","Error","DEFAULT_LISTBOX_TAG","props","value","onChange","horizontal","passThroughProps","reducerBag","useReducer","propsRef","current","labelRef","createRef","buttonRef","optionsRef","dispatch","useIsoMorphicEffect","type","useWindowEvent","target","event","CloseListbox","isFocusableElement","FocusableMode","slot","useMemo","open","State","render","defaultTag","name","DEFAULT_BUTTON_TAG","Button","forwardRefWithAs","useListboxContext","useSyncRefs","useId","d","useDisposables","handleKeyDown","useCallback","Keys","OpenListbox","focus","Focus","First","Last","handleKeyUp","handleClick","isDisabledReactIssue7711","preventScroll","labelledby","useComputed","passthroughProps","propsWeControl","ref","useResolveButtonType","onKeyDown","onKeyUp","onClick","DEFAULT_LABEL_TAG","Label","DEFAULT_OPTIONS_TAG","OptionsRenderFeatures","Features","Options","searchDisposables","usesOpenClosedState","useOpenClosed","visible","container","document","key","disposables","vertical","ArrowRight","Next","ArrowLeft","Previous","ClearSearch","role","tabIndex","features","DEFAULT_OPTION_TAG","Option","active","selected","bag","useRef","select","block","handleFocus","Nothing","handleMove","handleLeave","onFocus","onPointerMove","onMouseMove","onPointerLeave","onMouseLeave"],"mappings":";;;;;;;;;;;;;;;;;;;;AAoCA,IAAA,aAAA;;AAAA,CAAA,UAAKA,aAAL,EAAKA;EACHA,aAAAA,CAAAA,aAAAA,CAAAA,MAAAA,CAAAA,GAAAA,CAAAA,CAAAA,GAAAA,MAAAA;EACAA,aAAAA,CAAAA,aAAAA,CAAAA,QAAAA,CAAAA,GAAAA,CAAAA,CAAAA,GAAAA,QAAAA;AAFF,CAAA,EAAKA,aAAa,KAAbA,aAAa,GAAlB,EAAkB,CAAlB;;AA2BA,IAAA,WAAA;;AAAA,CAAA,UAAKC,WAAL,EAAKA;EACHA,WAAAA,CAAAA,WAAAA,CAAAA,aAAAA,CAAAA,GAAAA,CAAAA,CAAAA,GAAAA,aAAAA;EACAA,WAAAA,CAAAA,WAAAA,CAAAA,cAAAA,CAAAA,GAAAA,CAAAA,CAAAA,GAAAA,cAAAA;EAEAA,WAAAA,CAAAA,WAAAA,CAAAA,aAAAA,CAAAA,GAAAA,CAAAA,CAAAA,GAAAA,aAAAA;EACAA,WAAAA,CAAAA,WAAAA,CAAAA,gBAAAA,CAAAA,GAAAA,CAAAA,CAAAA,GAAAA,gBAAAA;EAEAA,WAAAA,CAAAA,WAAAA,CAAAA,YAAAA,CAAAA,GAAAA,CAAAA,CAAAA,GAAAA,YAAAA;EACAA,WAAAA,CAAAA,WAAAA,CAAAA,QAAAA,CAAAA,GAAAA,CAAAA,CAAAA,GAAAA,QAAAA;EACAA,WAAAA,CAAAA,WAAAA,CAAAA,aAAAA,CAAAA,GAAAA,CAAAA,CAAAA,GAAAA,aAAAA;EAEAA,WAAAA,CAAAA,WAAAA,CAAAA,gBAAAA,CAAAA,GAAAA,CAAAA,CAAAA,GAAAA,gBAAAA;EACAA,WAAAA,CAAAA,WAAAA,CAAAA,kBAAAA,CAAAA,GAAAA,CAAAA,CAAAA,GAAAA,kBAAAA;AAZF,CAAA,EAAKA,WAAW,KAAXA,WAAW,GAAhB,EAAgB,CAAhB;;AA2BA,IAAIC,QAAQ,IAAA,SAAA,GAAA,EAAA,EAAA,SAAA,CAMTD,WAAW,CANF,YAAA,CAAA,GAAA,UAAA,KAAA,EAAA;EAOR,IAAIE,KAAK,CAAT,QAAA,EAAoB,OAAA,KAAA;EACpB,IAAIA,KAAK,CAALA,YAAAA,KAAuBH,aAAa,CAAxC,MAAA,EAAiD,OAAA,KAAA;EACjD,OAAA,QAAA,CAAA,EAAA,EAAA,KAAA,EAAA;IAAmBI,iBAAiB,EAApC,IAAA;IAA4CC,YAAY,EAAEL,aAAa,CAACM;EAAxE,CAAA,CAAA;AATQ,CAAA,EAAA,SAAA,CAWTL,WAAW,CAXF,WAAA,CAAA,GAAA,UAAA,KAAA,EAAA;EAYR,IAAIE,KAAK,CAAT,QAAA,EAAoB,OAAA,KAAA;EACpB,IAAIA,KAAK,CAALA,YAAAA,KAAuBH,aAAa,CAAxC,IAAA,EAA+C,OAAA,KAAA;EAC/C,OAAA,QAAA,CAAA,EAAA,EAAA,KAAA,EAAA;IAAmBK,YAAY,EAAEL,aAAa,CAACO;EAA/C,CAAA,CAAA;AAdQ,CAAA,EAAA,SAAA,CAgBTN,WAAW,CAhBF,WAAA,CAAA,GAAA,UAAA,KAAA,EAAA,MAAA,EAAA;EAiBR,IAAIE,KAAK,CAALA,QAAAA,KAAmBK,MAAM,CAA7B,QAAA,EAAwC,OAAA,KAAA;EACxC,OAAA,QAAA,CAAA,EAAA,EAAA,KAAA,EAAA;IAAmBC,QAAQ,EAAED,MAAM,CAACC;EAApC,CAAA,CAAA;AAlBQ,CAAA,EAAA,SAAA,CAoBTR,WAAW,CApBF,cAAA,CAAA,GAAA,UAAA,KAAA,EAAA,MAAA,EAAA;EAqBR,IAAIE,KAAK,CAALA,WAAAA,KAAsBK,MAAM,CAAhC,WAAA,EAA8C,OAAA,KAAA;EAC9C,OAAA,QAAA,CAAA,EAAA,EAAA,KAAA,EAAA;IAAmBE,WAAW,EAAEF,MAAM,CAACE;EAAvC,CAAA,CAAA;AAtBQ,CAAA,EAAA,SAAA,CAwBTT,WAAW,CAxBF,UAAA,CAAA,GAAA,UAAA,KAAA,EAAA,MAAA,EAAA;EAyBR,IAAIE,KAAK,CAAT,QAAA,EAAoB,OAAA,KAAA;EACpB,IAAIA,KAAK,CAALA,YAAAA,KAAuBH,aAAa,CAAxC,MAAA,EAAiD,OAAA,KAAA;EAEjD,IAAII,iBAAiB,GAAGO,oBAAoB,CAAA,MAAA,EAAS;IACnDC,YAAY,EAAE,SAAA,YAAA,GAAA;MAAA,OAAMT,KAAK,CAAX,OAAA;IADqC,CAAA;IAEnDU,kBAAkB,EAAE,SAAA,kBAAA,GAAA;MAAA,OAAMV,KAAK,CAAX,iBAAA;IAF+B,CAAA;IAGnDW,SAAS,EAAE,SAAA,SAAA,CAAA,IAAA,EAAI;MAAA,OAAIC,IAAI,CAAR,EAAA;IAHoC,CAAA;IAInDC,eAAe,EAAE,SAAA,eAAA,CAAA,IAAA,EAAI;MAAA,OAAID,IAAI,CAAJA,OAAAA,CAAAA,OAAAA,CAAJ,QAAA;IAAA;EAJ8B,CAAT,CAA5C;EAOA,IAAIZ,KAAK,CAALA,WAAAA,KAAAA,EAAAA,IAA4BA,KAAK,CAALA,iBAAAA,KAAhC,iBAAA,EAA+E,OAAA,KAAA;EAC/E,OAAA,QAAA,CAAA,EAAA,EAAA,KAAA,EAAA;IAAmBc,WAAW,EAA9B,EAAA;IAAoCb,iBAAiB,EAAjBA;EAApC,CAAA,CAAA;AApCQ,CAAA,EAAA,SAAA,CAsCTH,WAAW,CAtCF,MAAA,CAAA,GAsCY,UAAA,KAAA,EAAA,MAAA,EAAA;EACpB,IAAIE,KAAK,CAAT,QAAA,EAAoB,OAAA,KAAA;EACpB,IAAIA,KAAK,CAALA,YAAAA,KAAuBH,aAAa,CAAxC,MAAA,EAAiD,OAAA,KAAA;EAEjD,IAAIiB,WAAW,GAAGd,KAAK,CAALA,WAAAA,GAAoBK,MAAM,CAANA,KAAAA,CAAtC,WAAsCA,EAAtC;EACA,IAAIU,KAAK,GAAG,KAAK,CAAL,OAAA,CAAA,SAAA,CACV,UAAA,MAAA,EAAM;IAAA,IAAA,qBAAA;;IAAA,OACJ,CAACC,MAAM,CAANA,OAAAA,CAAAA,OAAAA,CAAD,QAAA,KAAA,CAAA,qBAAA,GACAA,MAAM,CAANA,OAAAA,CAAAA,OAAAA,CADA,SAAA,KAAA,IAAA,GAAA,KAAA,CAAA,GACAA,qBAAAA,CAAAA,UAAAA,CAFI,WAEJA,CADA,CADI;EADR,CAAY,CAAZ;EAMA,IAAID,KAAK,KAAK,CAAVA,CAAAA,IAAgBA,KAAK,KAAKf,KAAK,CAAnC,iBAAA,EAAuD,OAAA,QAAA,CAAA,EAAA,EAAA,KAAA,EAAA;IAAmBc,WAAW,EAAXA;EAAnB,CAAA,CAAA;EACvD,OAAA,QAAA,CAAA,EAAA,EAAA,KAAA,EAAA;IAAmBA,WAAW,EAA9B,WAAA;IAAgCb,iBAAiB,EAAEc;EAAnD,CAAA,CAAA;AAlDQ,CAAA,EAAA,SAAA,CAoDTjB,WAAW,CApDF,WAAA,CAAA,GAAA,UAAA,KAAA,EAAA;EAqDR,IAAIE,KAAK,CAAT,QAAA,EAAoB,OAAA,KAAA;EACpB,IAAIA,KAAK,CAALA,YAAAA,KAAuBH,aAAa,CAAxC,MAAA,EAAiD,OAAA,KAAA;EACjD,IAAIG,KAAK,CAALA,WAAAA,KAAJ,EAAA,EAA8B,OAAA,KAAA;EAC9B,OAAA,QAAA,CAAA,EAAA,EAAA,KAAA,EAAA;IAAmBc,WAAW,EAAE;EAAhC,CAAA,CAAA;AAxDQ,CAAA,EAAA,SAAA,CA0DThB,WAAW,CA1DF,cAAA,CAAA,GA0DoB,UAAA,KAAA,EAAA,MAAA,EAAA;EAAA,OAAA,QAAA,CAAA,EAAA,EAAA,KAAA,EAAA;IAE5BmB,OAAO,EAAA,GAAA,MAAA,CAAMjB,KAAK,CAAX,OAAA,EAAA,CAAqB;MAAEkB,EAAE,EAAEb,MAAM,CAAZ,EAAA;MAAiBc,OAAO,EAAEd,MAAM,CAACc;IAAjC,CAArB,CAAA;EAFqB,CAAA,CAAA;AA1DpB,CAAA,EAAA,SAAA,CA8DTrB,WAAW,CA9DF,gBAAA,CAAA,GA8DsB,UAAA,KAAA,EAAA,MAAA,EAAA;EAC9B,IAAIsB,WAAW,GAAGpB,KAAK,CAALA,OAAAA,CAAlB,KAAkBA,EAAlB;EACA,IAAIqB,mBAAmB,GACrBrB,KAAK,CAALA,iBAAAA,KAAAA,IAAAA,GAAmCoB,WAAW,CAACpB,KAAK,CAApDA,iBAA8C,CAA9CA,GADF,IAAA;EAGA,IAAIsB,GAAG,GAAG,WAAW,CAAX,SAAA,CAAsB,UAAA,CAAA,EAAC;IAAA,OAAIC,CAAC,CAADA,EAAAA,KAASlB,MAAM,CAAnB,EAAA;EAAjC,CAAU,CAAV;EAEA,IAAIiB,GAAG,KAAK,CAAZ,CAAA,EAAgBF,WAAW,CAAXA,MAAAA,CAAAA,GAAAA,EAAAA,CAAAA;EAEhB,OAAA,QAAA,CAAA,EAAA,EAAA,KAAA,EAAA;IAEEH,OAAO,EAFT,WAAA;IAGEhB,iBAAiB,EAAG,YAAA;MAClB,IAAIqB,GAAG,KAAKtB,KAAK,CAAjB,iBAAA,EAAqC,OAAA,IAAA;MACrC,IAAIqB,mBAAmB,KAAvB,IAAA,EAAkC,OAAA,IAAA,CAFhB,CAEgB;MAGlC;;MACA,OAAOD,WAAW,CAAXA,OAAAA,CAAP,mBAAOA,CAAP;IANiB,CAAC;EAHtB,CAAA,CAAA;AAvEQ,CAAA,EAAZ,SAAY,CAAZ;AAsFA,IAAII,cAAc,GAAA,aAAGC,aAAa,CAAlC,IAAkC,CAAlC;AACAD,cAAc,CAAdA,WAAAA,GAAAA,gBAAAA;;AAEA,SAAA,iBAAA,CAAA,SAAA,EAAA;EACE,IAAIE,OAAO,GAAGC,UAAU,CAAxB,cAAwB,CAAxB;;EACA,IAAID,OAAO,KAAX,IAAA,EAAsB;IACpB,IAAIE,GAAG,GAAG,IAAA,KAAA,CAAA,MAAA,SAAA,GAAA,2BAAA,GAAmDC,OAAO,CAA1D,IAAA,GAAV,gBAAU,CAAV;IACA,IAAIC,KAAK,CAAT,iBAAA,EAA6BA,KAAK,CAALA,iBAAAA,CAAAA,GAAAA,EAAAA,iBAAAA;IAC7B,MAAA,GAAA;EACD;;EACD,OAAA,OAAA;AACD;;AAED,SAAA,YAAA,CAAA,KAAA,EAAA,MAAA,EAAA;EACE,OAAOf,KAAK,CAACV,MAAM,CAAP,IAAA,EAAA,QAAA,EAAA,KAAA,EAAZ,MAAY,CAAZ;AACD,C,CAAA;;;AAID,IAAI0B,mBAAmB,GAAvB,QAAA;;SAMgBF,O,CACdG,K,EAAAA;;;MAOMC,KAAAA,GAA+ED,KAAAA,CAA/EC,K;MAAOC,QAAAA,GAAwEF,KAAAA,CAAxEE,Q;wBAAwEF,KAAAA,CAA9D1B,Q;MAAAA,QAAAA,GAAAA,eAAAA,KAAAA,KAAAA,CAAAA,GAAW,KAAXA,GAAW,e;0BAAmD0B,KAAAA,CAA5CG,U;MAAAA,UAAAA,GAAAA,iBAAAA,KAAAA,KAAAA,CAAAA,GAAa,KAAbA,GAAa,iB;MAAUC,gBAAAA,GAAAA,6BAAAA,CAAqBJ,KAArBI,EAAqBJ,CAAAA,OAAAA,EAAAA,UAAAA,EAAAA,UAAAA,EAAAA,YAAAA,CAArBI,C;;EAChE,IAAM7B,WAAW,GAAG4B,UAAU,GAAA,YAAA,GAA9B,UAAA;EAEA,IAAIE,UAAU,GAAGC,UAAU,CAAA,YAAA,EAAe;IACxCpC,YAAY,EAAEL,aAAa,CADa,MAAA;IAExC0C,QAAQ,EAAE;MAAEC,OAAO,EAAE;QAAEP,KAAK,EAAP,KAAA;QAASC,QAAQ,EAARA;MAAT;IAAX,CAF8B;IAGxCO,QAAQ,EAAEC,SAH8B,EAAA;IAIxCC,SAAS,EAAED,SAJ6B,EAAA;IAKxCE,UAAU,EAAEF,SAL4B,EAAA;IAMxCpC,QAAQ,EANgC,QAAA;IAOxCC,WAAW,EAP6B,WAAA;IAQxCU,OAAO,EARiC,EAAA;IASxCH,WAAW,EAT6B,EAAA;IAUxCb,iBAAiB,EAAE;EAVqB,CAAf,CAA3B;qBAYoEoC,UAAAA,CAAAA,CAAAA,C;MAA7DnC,YAAAA,GAAAA,YAAAA,CAAAA,Y;MAAcqC,QAAAA,GAAAA,YAAAA,CAAAA,Q;MAAUK,UAAAA,GAAAA,YAAAA,CAAAA,U;MAAYD,SAAAA,GAAAA,YAAAA,CAAAA,S;MAAaE,QAAAA,GAAYR,UAAAA,CAAAA,CAAAA,C;EAEpES,mBAAmB,CAAC,YAAA;IAClBP,QAAQ,CAARA,OAAAA,CAAAA,KAAAA,GAAAA,KAAAA;EADiB,CAAA,EAEhB,CAAA,KAAA,EAFHO,QAEG,CAFgB,CAAnBA;EAGAA,mBAAmB,CAAC,YAAA;IAClBP,QAAQ,CAARA,OAAAA,CAAAA,QAAAA,GAAAA,QAAAA;EADiB,CAAA,EAEhB,CAAA,QAAA,EAFHO,QAEG,CAFgB,CAAnBA;EAGAA,mBAAmB,CAAC,YAAA;IAAA,OAAMD,QAAQ,CAAC;MAAEE,IAAI,EAAEjD,WAAW,CAAnB,WAAA;MAAiCQ,QAAQ,EAARA;IAAjC,CAAD,CAAd;EAAD,CAAA,EAA8D,CAAjFwC,QAAiF,CAA9D,CAAnBA;EACAA,mBAAmB,CAAC,YAAA;IAAA,OAAMD,QAAQ,CAAC;MAAEE,IAAI,EAAEjD,WAAW,CAAnB,cAAA;MAAoCS,WAAW,EAAXA;IAApC,CAAD,CAAd;EAAD,CAAA,EAAoE,CAAvFuC,WAAuF,CAApE,CAAnBA,CA/BAd,CA+BAc;;EAKAE,cAAc,CAAA,WAAA,EAAc,UAAA,KAAA,EAAK;;;IAC/B,IAAIC,MAAM,GAAGC,KAAK,CAAlB,MAAA;IAEA,IAAIhD,YAAY,KAAKL,aAAa,CAAlC,IAAA,EAAyC;IAEzC,IAAA,CAAA,kBAAA,GAAI8C,SAAS,CAAb,OAAA,KAAA,IAAA,GAAA,KAAA,CAAA,GAAIA,kBAAAA,CAAAA,QAAAA,CAAJ,MAAIA,CAAJ,EAAyC;IACzC,IAAA,CAAA,mBAAA,GAAIC,UAAU,CAAd,OAAA,KAAA,IAAA,GAAA,KAAA,CAAA,GAAIA,mBAAAA,CAAAA,QAAAA,CAAJ,MAAIA,CAAJ,EAA0C;IAE1CC,QAAQ,CAAC;MAAEE,IAAI,EAAEjD,WAAW,CAACqD;IAApB,CAAD,CAARN;;IAEA,IAAI,CAACO,kBAAkB,CAAA,MAAA,EAASC,aAAa,CAA7C,KAAuB,CAAvB,EAAsD;MAAA,IAAA,mBAAA;;MACpDH,KAAK,CAALA,cAAAA;MACA,CAAA,mBAAA,GAAA,SAAS,CAAT,OAAA,KAAA,IAAA,GAAA,KAAA,CAAA,GAAA,mBAAA,CAAA,KAAA,EAAA;IACD;EAbHF,CAAc,CAAdA;EAgBA,IAAIM,IAAI,GAAGC,OAAO,CAChB,YAAA;IAAA,OAAO;MAAEC,IAAI,EAAEtD,YAAY,KAAKL,aAAa,CAAtC,IAAA;MAA6CS,QAAQ,EAARA;IAA7C,CAAP;EADgB,CAAA,EAEhB,CAAA,YAAA,EAFF,QAEE,CAFgB,CAAlB;EAKA,OACE,KAAA,CAAA,aAAA,CAACkB,cAAc,CAAf,QAAA,EAAA;IAAyBS,KAAK,EAAEI;EAAhC,CAAA,EACE,KAAA,CAAA,aAAA,CAAA,kBAAA,EAAA;IACEJ,KAAK,EAAElB,KAAK,CAAA,YAAA,GAAA,MAAA,GAAA,EAAA,EAAA,MAAA,CACTlB,aAAa,CADJ,IAAA,CAAA,GACY4D,KAAK,CADjB,IAAA,EAAA,MAAA,CAET5D,aAAa,CAFJ,MAAA,CAAA,GAEc4D,KAAK,CAFnB,MAAA,EAAA,MAAA;EADd,CAAA,EAMGC,MAAM,CAAC;IACN1B,KAAK,EADC,gBAAA;IAENsB,IAAI,EAFE,IAAA;IAGNK,UAAU,EAHJ,mBAAA;IAINC,IAAI,EAAE;EAJA,CAAD,CANT,CADF,CADF;AAiBD,C,CAAA;;;AAID,IAAIC,kBAAkB,GAAtB,QAAA;AAgBA,IAAIC,MAAM,GAAA,aAAGC,gBAAgB,CAAC,SAAA,MAAA,CAAA,KAAA,EAAA,GAAA,EAAA;;;2BAIJC,iBAAiB,CAAC,CAACnC,OAAO,CAAR,IAAA,EAAeiC,MAAM,CAArB,IAAA,EAAA,IAAA,CAAD,GAAC,CAAD,C;MAApC9D,KAAAA,GAAAA,kBAAAA,CAAAA,CAAAA,C;MAAO6C,QAAAA,GAAAA,kBAAAA,CAAAA,CAAAA,C;;EACZ,IAAIF,SAAS,GAAGsB,WAAW,CAACjE,KAAK,CAAN,SAAA,EAA3B,GAA2B,CAA3B;EAEA,IAAIkB,EAAE,GAAA,+BAAgCgD,KAAtC,EAAA;EACA,IAAIC,CAAC,GAAGC,cAAR,EAAA;EAEA,IAAIC,aAAa,GAAGC,WAAW,CAC7B,UAAA,KAAA,EAAA;IACE,QAAQpB,KAAK,CAAb,GAAA;MACE;MAEA,KAAKqB,IAAI,CAAT,KAAA;MACA,KAAKA,IAAI,CAAT,KAAA;MACA,KAAKA,IAAI,CAAT,SAAA;QACErB,KAAK,CAALA,cAAAA;QACAL,QAAQ,CAAC;UAAEE,IAAI,EAAEjD,WAAW,CAAC0E;QAApB,CAAD,CAAR3B;QACAsB,CAAC,CAADA,SAAAA,CAAY,YAAA;UACV,IAAI,CAACnE,KAAK,CAALA,QAAAA,CAAAA,OAAAA,CAAL,KAAA,EACE,QAAQ,CAAC;YAAE+C,IAAI,EAAEjD,WAAW,CAAnB,UAAA;YAAgC2E,KAAK,EAAEC,KAAK,CAACC;UAA7C,CAAD,CAAR;QAFJR,CAAAA;QAIA;;MAEF,KAAKI,IAAI,CAAT,OAAA;QACErB,KAAK,CAALA,cAAAA;QACAL,QAAQ,CAAC;UAAEE,IAAI,EAAEjD,WAAW,CAAC0E;QAApB,CAAD,CAAR3B;QACAsB,CAAC,CAADA,SAAAA,CAAY,YAAA;UACV,IAAI,CAACnE,KAAK,CAALA,QAAAA,CAAAA,OAAAA,CAAL,KAAA,EACE,QAAQ,CAAC;YAAE+C,IAAI,EAAEjD,WAAW,CAAnB,UAAA;YAAgC2E,KAAK,EAAEC,KAAK,CAACE;UAA7C,CAAD,CAAR;QAFJT,CAAAA;QAIA;IArBJ;EAF2B,CAAA,EA0B7B,CAAA,QAAA,EAAA,KAAA,EA1BF,CA0BE,CA1B6B,CAA/B;EA6BA,IAAIU,WAAW,GAAGP,WAAW,CAAC,UAAA,KAAA,EAAA;IAC5B,QAAQpB,KAAK,CAAb,GAAA;MACE,KAAKqB,IAAI,CAAT,KAAA;QACE;QACA;QACA;QACArB,KAAK,CAALA,cAAAA;QACA;IANJ;EAD2B,CAAA,EAA7B,EAA6B,CAA7B;EAWA,IAAI4B,WAAW,GAAGR,WAAW,CAC3B,UAAA,KAAA,EAAA;IACE,IAAIS,wBAAwB,CAAC7B,KAAK,CAAlC,aAA4B,CAA5B,EAAmD,OAAOA,KAAK,CAAZ,cAAOA,EAAP;;IACnD,IAAIlD,KAAK,CAALA,YAAAA,KAAuBH,aAAa,CAAxC,IAAA,EAA+C;MAC7CgD,QAAQ,CAAC;QAAEE,IAAI,EAAEjD,WAAW,CAACqD;MAApB,CAAD,CAARN;MACAsB,CAAC,CAADA,SAAAA,CAAY,YAAA;QAAA,IAAA,qBAAA;;QAAA,OAAA,CAAA,qBAAA,GAAM,KAAK,CAAL,SAAA,CAAN,OAAA,KAAA,IAAA,GAAA,KAAA,CAAA,GAAM,qBAAA,CAAA,KAAA,CAA+B;UAAEa,aAAa,EAAE;QAAjB,CAA/B,CAAN;MAAZb,CAAAA;IAFF,CAAA,MAGO;MACLjB,KAAK,CAALA,cAAAA;MACAL,QAAQ,CAAC;QAAEE,IAAI,EAAEjD,WAAW,CAAC0E;MAApB,CAAD,CAAR3B;IACD;EATwB,CAAA,EAW3B,CAAA,QAAA,EAAA,CAAA,EAXF,KAWE,CAX2B,CAA7B;EAcA,IAAIoC,UAAU,GAAGC,WAAW,CAAC,YAAA;IAC3B,IAAI,CAAClF,KAAK,CAALA,QAAAA,CAAL,OAAA,EAA6B,OAAA,SAAA;IAC7B,OAAO,CAACA,KAAK,CAALA,QAAAA,CAAAA,OAAAA,CAAD,EAAA,EAAA,EAAA,EAAA,IAAA,CAAP,GAAO,CAAP;EAF0B,CAAA,EAGzB,CAACA,KAAK,CAALA,QAAAA,CAAD,OAAA,EAHH,EAGG,CAHyB,CAA5B;EAKA,IAAIsD,IAAI,GAAGC,OAAO,CAChB,YAAA;IAAA,OAAO;MAAEC,IAAI,EAAExD,KAAK,CAALA,YAAAA,KAAuBH,aAAa,CAA5C,IAAA;MAAmDS,QAAQ,EAAEN,KAAK,CAACM;IAAnE,CAAP;EADgB,CAAA,EAEhB,CAFF,KAEE,CAFgB,CAAlB;EAIA,IAAI6E,gBAAgB,GAApB,KAAA;EACA,IAAIC,cAAc,GAAG;IACnBC,GAAG,EADgB,SAAA;IAEnBnE,EAAE,EAFiB,EAAA;IAGnB6B,IAAI,EAAEuC,oBAAoB,CAAA,KAAA,EAAQtF,KAAK,CAHpB,SAGO,CAHP;IAInB,iBAJmB,IAAA;IAKnB,iBAAA,CAAA,qBAAA,GAAiBA,KAAK,CAALA,UAAAA,CAAjB,OAAA,KAAA,IAAA,GAAA,KAAA,CAAA,GAAiBA,qBAAAA,CALE,EAAA;IAMnB,iBAAiBA,KAAK,CAALA,QAAAA,GAAAA,SAAAA,GAA6BA,KAAK,CAALA,YAAAA,KAAuBH,aAAa,CAN/D,IAAA;IAOnB,mBAPmB,UAAA;IAQnBS,QAAQ,EAAEN,KAAK,CARI,QAAA;IASnBuF,SAAS,EATU,aAAA;IAUnBC,OAAO,EAVY,WAAA;IAWnBC,OAAO,EAAEX;EAXU,CAArB;EAcA,OAAOpB,MAAM,CAAC;IACZ1B,KAAK,EAAA,QAAA,CAAA,EAAA,EAAA,gBAAA,EADO,cACP,CADO;IAEZsB,IAAI,EAFQ,IAAA;IAGZK,UAAU,EAHE,kBAAA;IAIZC,IAAI,EAAE;EAJM,CAAD,CAAb;AAxFF,CAA6B,CAA7B,C,CAAA;;AAkGA,IAAI8B,iBAAiB,GAArB,OAAA;;AAOA,SAAA,KAAA,CAAA,KAAA,EAAA;4BAGgB1B,iBAAiB,CAAC,CAACnC,OAAO,CAAR,IAAA,EAAe8D,KAAK,CAApB,IAAA,EAAA,IAAA,CAAD,GAAC,CAAD,C;MAA1B3F,KAAAA,GAAAA,mBAAAA,CAAAA,CAAAA,C;;EACL,IAAIkB,EAAE,GAAA,8BAA+BgD,KAArC,EAAA;EAEA,IAAIY,WAAW,GAAGR,WAAW,CAAC,YAAA;IAAA,IAAA,sBAAA;;IAAA,OAAA,CAAA,sBAAA,GAAM,KAAK,CAAL,SAAA,CAAN,OAAA,KAAA,IAAA,GAAA,KAAA,CAAA,GAAM,sBAAA,CAAA,KAAA,CAA+B;MAAEU,aAAa,EAAE;IAAjB,CAA/B,CAAN;EAAD,CAAA,EAAgE,CAC3FhF,KAAK,CADP,SAA6F,CAAhE,CAA7B;EAIA,IAAIsD,IAAI,GAAGC,OAAO,CAChB,YAAA;IAAA,OAAO;MAAEC,IAAI,EAAExD,KAAK,CAALA,YAAAA,KAAuBH,aAAa,CAA5C,IAAA;MAAmDS,QAAQ,EAAEN,KAAK,CAACM;IAAnE,CAAP;EADgB,CAAA,EAEhB,CAFF,KAEE,CAFgB,CAAlB;EAIA,IAAI8E,cAAc,GAAG;IAAEC,GAAG,EAAErF,KAAK,CAAZ,QAAA;IAAuBkB,EAAE,EAAzB,EAAA;IAA2BuE,OAAO,EAAEX;EAApC,CAArB;EACA,OAAOpB,MAAM,CAAC;IACZ1B,KAAK,EAAA,QAAA,CAAA,EAAA,EAAA,KAAA,EADO,cACP,CADO;IAEZsB,IAAI,EAFQ,IAAA;IAGZK,UAAU,EAHE,iBAAA;IAIZC,IAAI,EAAE;EAJM,CAAD,CAAb;AAMD,C,CAAA;;;AAID,IAAIgC,mBAAmB,GAAvB,IAAA;AAaA,IAAIC,qBAAqB,GAAGC,QAAQ,CAARA,cAAAA,GAA0BA,QAAQ,CAA9D,MAAA;AAEA,IAAIC,OAAO,GAAA,aAAGhC,gBAAgB,CAAC,SAAA,OAAA,CAAA,KAAA,EAAA,GAAA,EAAA;;;4BAOLC,iBAAiB,CAAC,CAACnC,OAAO,CAAR,IAAA,EAAekE,OAAO,CAAtB,IAAA,EAAA,IAAA,CAAD,GAAC,CAAD,C;MAApC/F,KAAAA,GAAAA,mBAAAA,CAAAA,CAAAA,C;MAAO6C,QAAAA,GAAAA,mBAAAA,CAAAA,CAAAA,C;;EACZ,IAAID,UAAU,GAAGqB,WAAW,CAACjE,KAAK,CAAN,UAAA,EAA5B,GAA4B,CAA5B;EAEA,IAAIkB,EAAE,GAAA,gCAAiCgD,KAAvC,EAAA;EACA,IAAIC,CAAC,GAAGC,cAAR,EAAA;EACA,IAAI4B,iBAAiB,GAAG5B,cAAxB,EAAA;EAEA,IAAI6B,mBAAmB,GAAGC,aAA1B,EAAA;;EACA,IAAIC,OAAO,GAAI,YAAA;IACb,IAAIF,mBAAmB,KAAvB,IAAA,EAAkC;MAChC,OAAOA,mBAAmB,KAAKxC,KAAK,CAApC,IAAA;IACD;;IAED,OAAOzD,KAAK,CAALA,YAAAA,KAAuBH,aAAa,CAA3C,IAAA;EALF,CAAe,EAAf;;EAQAiD,mBAAmB,CAAC,YAAA;IAClB,IAAIsD,SAAS,GAAGpG,KAAK,CAALA,UAAAA,CAAhB,OAAA;IACA,IAAI,CAAJ,SAAA,EAAgB;IAChB,IAAIA,KAAK,CAALA,YAAAA,KAAuBH,aAAa,CAAxC,IAAA,EAA+C;IAC/C,IAAIuG,SAAS,KAAKC,QAAQ,CAA1B,aAAA,EAA0C;IAE1CD,SAAS,CAATA,KAAAA,CAAgB;MAAEpB,aAAa,EAAE;IAAjB,CAAhBoB;EANiB,CAAA,EAOhB,CAACpG,KAAK,CAAN,YAAA,EAAqBA,KAAK,CAP7B8C,UAOG,CAPgB,CAAnBA;EASA,IAAIuB,aAAa,GAAGC,WAAW,CAC7B,UAAA,KAAA,EAAA;IACE0B,iBAAiB,CAAjBA,OAAAA;;IAEA,QAAQ9C,KAAK,CAAb,GAAA;MACE;MAEA;MACA,KAAKqB,IAAI,CAAT,KAAA;QACE,IAAIvE,KAAK,CAALA,WAAAA,KAAJ,EAAA,EAA8B;UAC5BkD,KAAK,CAALA,cAAAA;UACAA,KAAK,CAALA,eAAAA;UACA,OAAOL,QAAQ,CAAC;YAAEE,IAAI,EAAEjD,WAAW,CAAnB,MAAA;YAA4BmC,KAAK,EAAEiB,KAAK,CAACoD;UAAzC,CAAD,CAAf;QACD;;MACH;;MACA,KAAK/B,IAAI,CAAT,KAAA;QACErB,KAAK,CAALA,cAAAA;QACAA,KAAK,CAALA,eAAAA;QACAL,QAAQ,CAAC;UAAEE,IAAI,EAAEjD,WAAW,CAACqD;QAApB,CAAD,CAARN;;QACA,IAAI7C,KAAK,CAALA,iBAAAA,KAAJ,IAAA,EAAsC;UAAA,IAC9BmB,OAD8B,GAClBnB,KAAK,CAALA,OAAAA,CAAcA,KAAK,CADD,iBAClBA,EADkB,OAAA;UAEpCA,KAAK,CAALA,QAAAA,CAAAA,OAAAA,CAAAA,QAAAA,CAAgCmB,OAAO,CAAPA,OAAAA,CAAhCnB,KAAAA;QACD;;QACDuG,WAAW,GAAXA,SAAAA,CAAwB,YAAA;UAAA,IAAA,sBAAA;;UAAA,OAAA,CAAA,sBAAA,GAAM,KAAK,CAAL,SAAA,CAAN,OAAA,KAAA,IAAA,GAAA,KAAA,CAAA,GAAM,sBAAA,CAAA,KAAA,CAA+B;YAAEvB,aAAa,EAAE;UAAjB,CAA/B,CAAN;QAAxBuB,CAAAA;QACA;;MAEF,KAAKxF,KAAK,CAACf,KAAK,CAAN,WAAA,EAAoB;QAAEwG,QAAQ,EAAEjC,IAAI,CAAhB,SAAA;QAA4BpC,UAAU,EAAEoC,IAAI,CAACkC;MAA7C,CAApB,CAAV;QACEvD,KAAK,CAALA,cAAAA;QACAA,KAAK,CAALA,eAAAA;QACA,OAAOL,QAAQ,CAAC;UAAEE,IAAI,EAAEjD,WAAW,CAAnB,UAAA;UAAgC2E,KAAK,EAAEC,KAAK,CAACgC;QAA7C,CAAD,CAAf;;MAEF,KAAK3F,KAAK,CAACf,KAAK,CAAN,WAAA,EAAoB;QAAEwG,QAAQ,EAAEjC,IAAI,CAAhB,OAAA;QAA0BpC,UAAU,EAAEoC,IAAI,CAACoC;MAA3C,CAApB,CAAV;QACEzD,KAAK,CAALA,cAAAA;QACAA,KAAK,CAALA,eAAAA;QACA,OAAOL,QAAQ,CAAC;UAAEE,IAAI,EAAEjD,WAAW,CAAnB,UAAA;UAAgC2E,KAAK,EAAEC,KAAK,CAACkC;QAA7C,CAAD,CAAf;;MAEF,KAAKrC,IAAI,CAAT,IAAA;MACA,KAAKA,IAAI,CAAT,MAAA;QACErB,KAAK,CAALA,cAAAA;QACAA,KAAK,CAALA,eAAAA;QACA,OAAOL,QAAQ,CAAC;UAAEE,IAAI,EAAEjD,WAAW,CAAnB,UAAA;UAAgC2E,KAAK,EAAEC,KAAK,CAACC;QAA7C,CAAD,CAAf;;MAEF,KAAKJ,IAAI,CAAT,GAAA;MACA,KAAKA,IAAI,CAAT,QAAA;QACErB,KAAK,CAALA,cAAAA;QACAA,KAAK,CAALA,eAAAA;QACA,OAAOL,QAAQ,CAAC;UAAEE,IAAI,EAAEjD,WAAW,CAAnB,UAAA;UAAgC2E,KAAK,EAAEC,KAAK,CAACE;QAA7C,CAAD,CAAf;;MAEF,KAAKL,IAAI,CAAT,MAAA;QACErB,KAAK,CAALA,cAAAA;QACAA,KAAK,CAALA,eAAAA;QACAL,QAAQ,CAAC;UAAEE,IAAI,EAAEjD,WAAW,CAACqD;QAApB,CAAD,CAARN;QACA,OAAO,CAAC,CAAD,SAAA,CAAY,YAAA;UAAA,IAAA,sBAAA;;UAAA,OAAA,CAAA,sBAAA,GAAM,KAAK,CAAL,SAAA,CAAN,OAAA,KAAA,IAAA,GAAA,KAAA,CAAA,GAAM,sBAAA,CAAA,KAAA,CAA+B;YAAEmC,aAAa,EAAE;UAAjB,CAA/B,CAAN;QAAnB,CAAO,CAAP;;MAEF,KAAKT,IAAI,CAAT,GAAA;QACErB,KAAK,CAALA,cAAAA;QACAA,KAAK,CAALA,eAAAA;QACA;;MAEF;QACE,IAAIA,KAAK,CAALA,GAAAA,CAAAA,MAAAA,KAAJ,CAAA,EAA4B;UAC1BL,QAAQ,CAAC;YAAEE,IAAI,EAAEjD,WAAW,CAAnB,MAAA;YAA4BmC,KAAK,EAAEiB,KAAK,CAACoD;UAAzC,CAAD,CAARzD;UACAmD,iBAAiB,CAAjBA,UAAAA,CAA6B,YAAA;YAAA,OAAMnD,QAAQ,CAAC;cAAEE,IAAI,EAAEjD,WAAW,CAAC+G;YAApB,CAAD,CAAd;UAA7Bb,CAAAA,EAAAA,GAAAA;QACD;;QACD;IA5DJ;EAJ2B,CAAA,EAmE7B,CAAA,CAAA,EAAA,QAAA,EAAA,iBAAA,EAnEF,KAmEE,CAnE6B,CAA/B;EAsEA,IAAIf,UAAU,GAAGC,WAAW,CAAC,YAAA;IAAA,IAAA,qBAAA,EAAA,sBAAA,EAAA,sBAAA;;IAAA,OAAA,CAAA,qBAAA,GAAA,CAAA,sBAAA,GAAMlF,KAAK,CAALA,QAAAA,CAAN,OAAA,KAAA,IAAA,GAAA,KAAA,CAAA,GAAMA,sBAAAA,CAAN,EAAA,KAAA,IAAA,GAAA,qBAAA,GAAA,CAAA,sBAAA,GAAoCA,KAAK,CAALA,SAAAA,CAApC,OAAA,KAAA,IAAA,GAAA,KAAA,CAAA,GAAoCA,sBAAAA,CAApC,EAAA;EAAD,CAAA,EAAkE,CAC5FA,KAAK,CAALA,QAAAA,CAD4F,OAAA,EAE5FA,KAAK,CAALA,SAAAA,CAFF,OAA8F,CAAlE,CAA5B;EAKA,IAAIsD,IAAI,GAAGC,OAAO,CAChB,YAAA;IAAA,OAAO;MAAEC,IAAI,EAAExD,KAAK,CAALA,YAAAA,KAAuBH,aAAa,CAACO;IAA7C,CAAP;EADgB,CAAA,EAEhB,CAFF,KAEE,CAFgB,CAAlB;EAIA,IAAIgF,cAAc,GAAG;IACnB,yBACEpF,KAAK,CAALA,iBAAAA,KAAAA,IAAAA,GAAAA,SAAAA,GAAAA,CAAAA,qBAAAA,GAA+CA,KAAK,CAALA,OAAAA,CAAcA,KAAK,CAAlEA,iBAA+CA,CAA/CA,KAAAA,IAAAA,GAAAA,KAAAA,CAAAA,GAA+CA,qBAAAA,CAF9B,EAAA;IAGnB,mBAHmB,UAAA;IAInB,oBAAoBA,KAAK,CAJN,WAAA;IAKnBkB,EAAE,EALiB,EAAA;IAMnBqE,SAAS,EANU,aAAA;IAOnBuB,IAAI,EAPe,SAAA;IAQnBC,QAAQ,EARW,CAAA;IASnB1B,GAAG,EAAEzC;EATc,CAArB;EAWA,IAAIuC,gBAAgB,GAApB,KAAA;EAEA,OAAOzB,MAAM,CAAC;IACZ1B,KAAK,EAAA,QAAA,CAAA,EAAA,EAAA,gBAAA,EADO,cACP,CADO;IAEZsB,IAAI,EAFQ,IAAA;IAGZK,UAAU,EAHE,mBAAA;IAIZqD,QAAQ,EAJI,qBAAA;IAKZb,OAAO,EALK,OAAA;IAMZvC,IAAI,EAAE;EANM,CAAD,CAAb;AA5HF,CAA8B,CAA9B,C,CAAA;;AAwIA,IAAIqD,kBAAkB,GAAtB,IAAA;;AAkBA,SAAA,MAAA,CAAA,KAAA,EAAA;yBAWyDjF,KAAAA,CAAjD1B,Q;MAAAA,QAAAA,GAAAA,gBAAAA,KAAAA,KAAAA,CAAAA,GAAW,KAAXA,GAAW,gB;MAAO2B,KAAAA,GAA+BD,KAAAA,CAA/BC,K;MAAUkD,gBAAAA,GAAAA,6BAAAA,CAAqBnD,KAArBmD,EAAqBnD,CAAAA,UAAAA,EAAAA,OAAAA,CAArBmD,C;;4BACVnB,iBAAiB,CAAC,CAACnC,OAAO,CAAR,IAAA,EAAeqF,MAAM,CAArB,IAAA,EAAA,IAAA,CAAD,GAAC,CAAD,C;MAApClH,KAAAA,GAAAA,mBAAAA,CAAAA,CAAAA,C;MAAO6C,QAAAA,GAAAA,mBAAAA,CAAAA,CAAAA,C;;EACZ,IAAI3B,EAAE,GAAA,+BAAgCgD,KAAtC,EAAA;EACA,IAAIiD,MAAM,GACRnH,KAAK,CAALA,iBAAAA,KAAAA,IAAAA,GAAmCA,KAAK,CAALA,OAAAA,CAAcA,KAAK,CAAnBA,iBAAAA,EAAAA,EAAAA,KAAnCA,EAAAA,GADF,KAAA;EAEA,IAAIoH,QAAQ,GAAGpH,KAAK,CAALA,QAAAA,CAAAA,OAAAA,CAAAA,KAAAA,KAAf,KAAA;EAEA,IAAIqH,GAAG,GAAGC,MAAM,CAAkC;IAAEhH,QAAQ,EAAV,QAAA;IAAY2B,KAAK,EAALA;EAAZ,CAAlC,CAAhB;EAEAa,mBAAmB,CAAC,YAAA;IAClBuE,GAAG,CAAHA,OAAAA,CAAAA,QAAAA,GAAAA,QAAAA;EADiB,CAAA,EAEhB,CAAA,GAAA,EAFHvE,QAEG,CAFgB,CAAnBA;EAGAA,mBAAmB,CAAC,YAAA;IAClBuE,GAAG,CAAHA,OAAAA,CAAAA,KAAAA,GAAAA,KAAAA;EADiB,CAAA,EAEhB,CAAA,GAAA,EAFHvE,KAEG,CAFgB,CAAnBA;EAGAA,mBAAmB,CAAC,YAAA;;;IAClBuE,GAAG,CAAHA,OAAAA,CAAAA,SAAAA,GAAAA,CAAAA,qBAAAA,GAAwBhB,QAAQ,CAARA,cAAAA,CAAxBgB,EAAwBhB,CAAxBgB,KAAAA,IAAAA,GAAAA,KAAAA,CAAAA,GAAAA,CAAAA,sBAAAA,GAAwBhB,qBAAAA,CAAxBgB,WAAAA,KAAAA,IAAAA,GAAAA,KAAAA,CAAAA,GAAwBhB,sBAAAA,CAAxBgB,WAAwBhB,EAAxBgB;EADiB,CAAA,EAEhB,CAAA,GAAA,EAFHvE,EAEG,CAFgB,CAAnBA;EAIA,IAAIyE,MAAM,GAAGjD,WAAW,CAAC,YAAA;IAAA,OAAMtE,KAAK,CAALA,QAAAA,CAAAA,OAAAA,CAAAA,QAAAA,CAAN,KAAMA,CAAN;EAAD,CAAA,EAA+C,CAACA,KAAK,CAAN,QAAA,EAAvE,KAAuE,CAA/C,CAAxB;EAEA8C,mBAAmB,CAAC,YAAA;IAClBD,QAAQ,CAAC;MAAEE,IAAI,EAAEjD,WAAW,CAAnB,cAAA;MAAoCoB,EAAE,EAAtC,EAAA;MAAwCC,OAAO,EAAEkG;IAAjD,CAAD,CAARxE;IACA,OAAO,YAAA;MAAA,OAAMA,QAAQ,CAAC;QAAEE,IAAI,EAAEjD,WAAW,CAAnB,gBAAA;QAAsCoB,EAAE,EAAFA;MAAtC,CAAD,CAAd;IAAP,CAAA;EAFiB,CAAA,EAGhB,CAAA,GAAA,EAHH4B,EAGG,CAHgB,CAAnBA;EAKAA,mBAAmB,CAAC,YAAA;;;IAClB,IAAI9C,KAAK,CAALA,YAAAA,KAAuBH,aAAa,CAAxC,IAAA,EAA+C;IAC/C,IAAI,CAAJ,QAAA,EAAe;IACfgD,QAAQ,CAAC;MAAEE,IAAI,EAAEjD,WAAW,CAAnB,UAAA;MAAgC2E,KAAK,EAAEC,KAAK,CAA5C,QAAA;MAAuDxD,EAAE,EAAFA;IAAvD,CAAD,CAAR2B;IACA,CAAA,sBAAA,GAAA,QAAQ,CAAR,cAAA,CAAA,EAAA,CAAA,KAAA,IAAA,GAAA,KAAA,CAAA,GAAA,sBAAA,CAAA,KAAA,IAAA,IAAA,GAAA,KAAA,CAAA,GAAA,sBAAA,CAAA,KAAA,EAAA;EAJiB,CAAA,EAKhB,CAAC7C,KAAK,CALT8C,YAKG,CALgB,CAAnBA;EAOAA,mBAAmB,CAAC,YAAA;IAClB,IAAI9C,KAAK,CAALA,YAAAA,KAAuBH,aAAa,CAAxC,IAAA,EAA+C;IAC/C,IAAI,CAAJ,MAAA,EAAa;IACb,IAAIsE,CAAC,GAAGoC,WAAR,EAAA;IACApC,CAAC,CAADA,SAAAA,CAAY,YAAA;MAAA,IAAA,sBAAA;;MAAA,OAAA,CAAA,sBAAA,GAAM,QAAQ,CAAR,cAAA,CAAN,EAAM,CAAN,KAAA,IAAA,GAAA,KAAA,CAAA,GAAM,sBAAA,CAAN,cAAM,IAAN,IAAM,GAAN,KAAA,CAAM,GAAA,sBAAA,CAAA,cAAA,CAA8C;QAAEqD,KAAK,EAAE;MAAT,CAA9C,CAAN;IAAZrD,CAAAA;IACA,OAAOA,CAAC,CAAR,OAAA;EALiB,CAAA,EAMhB,CAAA,EAAA,EAAA,MAAA,EAAanE,KAAK,CANrB8C,YAMG,CANgB,CAAnBA;EAQA,IAAIgC,WAAW,GAAGR,WAAW,CAC3B,UAAA,KAAA,EAAA;IACE,IAAA,QAAA,EAAc,OAAOpB,KAAK,CAAZ,cAAOA,EAAP;IACdqE,MAAM;IACN1E,QAAQ,CAAC;MAAEE,IAAI,EAAEjD,WAAW,CAACqD;IAApB,CAAD,CAARN;IACA0D,WAAW,GAAXA,SAAAA,CAAwB,YAAA;MAAA,IAAA,sBAAA;;MAAA,OAAA,CAAA,sBAAA,GAAM,KAAK,CAAL,SAAA,CAAN,OAAA,KAAA,IAAA,GAAA,KAAA,CAAA,GAAM,sBAAA,CAAA,KAAA,CAA+B;QAAEvB,aAAa,EAAE;MAAjB,CAA/B,CAAN;IAAxBuB,CAAAA;EALyB,CAAA,EAO3B,CAAA,QAAA,EAAWvG,KAAK,CAAhB,SAAA,EAAA,QAAA,EAPF,MAOE,CAP2B,CAA7B;EAUA,IAAIyH,WAAW,GAAGnD,WAAW,CAAC,YAAA;IAC5B,IAAA,QAAA,EAAc,OAAOzB,QAAQ,CAAC;MAAEE,IAAI,EAAEjD,WAAW,CAAnB,UAAA;MAAgC2E,KAAK,EAAEC,KAAK,CAACgD;IAA7C,CAAD,CAAf;IACd7E,QAAQ,CAAC;MAAEE,IAAI,EAAEjD,WAAW,CAAnB,UAAA;MAAgC2E,KAAK,EAAEC,KAAK,CAA5C,QAAA;MAAuDxD,EAAE,EAAFA;IAAvD,CAAD,CAAR2B;EAF2B,CAAA,EAG1B,CAAA,QAAA,EAAA,EAAA,EAHH,QAGG,CAH0B,CAA7B;EAKA,IAAI8E,UAAU,GAAGrD,WAAW,CAAC,YAAA;IAC3B,IAAA,QAAA,EAAc;IACd,IAAA,MAAA,EAAY;IACZzB,QAAQ,CAAC;MAAEE,IAAI,EAAEjD,WAAW,CAAnB,UAAA;MAAgC2E,KAAK,EAAEC,KAAK,CAA5C,QAAA;MAAuDxD,EAAE,EAAFA;IAAvD,CAAD,CAAR2B;EAH0B,CAAA,EAIzB,CAAA,QAAA,EAAA,MAAA,EAAA,EAAA,EAJH,QAIG,CAJyB,CAA5B;EAMA,IAAI+E,WAAW,GAAGtD,WAAW,CAAC,YAAA;IAC5B,IAAA,QAAA,EAAc;IACd,IAAI,CAAJ,MAAA,EAAa;IACbzB,QAAQ,CAAC;MAAEE,IAAI,EAAEjD,WAAW,CAAnB,UAAA;MAAgC2E,KAAK,EAAEC,KAAK,CAACgD;IAA7C,CAAD,CAAR7E;EAH2B,CAAA,EAI1B,CAAA,QAAA,EAAA,MAAA,EAJH,QAIG,CAJ0B,CAA7B;EAMA,IAAIS,IAAI,GAAGC,OAAO,CAAsB,YAAA;IAAA,OAAO;MAAE4D,MAAM,EAAR,MAAA;MAAUC,QAAQ,EAAlB,QAAA;MAAoB9G,QAAQ,EAARA;IAApB,CAAP;EAAtB,CAAA,EAA8D,CAAA,MAAA,EAAA,QAAA,EAAhF,QAAgF,CAA9D,CAAlB;EAKA,IAAI8E,cAAc,GAAG;IACnBlE,EAAE,EADiB,EAAA;IAEnB4F,IAAI,EAFe,QAAA;IAGnBC,QAAQ,EAAEzG,QAAQ,KAARA,IAAAA,GAAAA,SAAAA,GAAgC,CAHvB,CAAA;IAInB,iBAAiBA,QAAQ,KAARA,IAAAA,GAAAA,IAAAA,GAJE,SAAA;IAKnB,iBAAiB8G,QAAQ,KAARA,IAAAA,GAAAA,IAAAA,GALE,SAAA;IAMnB9G,QAAQ,EANW,SAAA;IAOnBmF,OAAO,EAPY,WAAA;IAQnBoC,OAAO,EARY,WAAA;IASnBC,aAAa,EATM,UAAA;IAUnBC,WAAW,EAVQ,UAAA;IAWnBC,cAAc,EAXK,WAAA;IAYnBC,YAAY,EAAEL;EAZK,CAArB;EAeA,OAAOlE,MAAM,CAAC;IACZ1B,KAAK,EAAA,QAAA,CAAA,EAAA,EAAA,gBAAA,EADO,cACP,CADO;IAEZsB,IAAI,EAFQ,IAAA;IAGZK,UAAU,EAHE,kBAAA;IAIZC,IAAI,EAAE;EAJM,CAAD,CAAb;AAMD,C,CAAA;;;AAID/B,OAAO,CAAPA,MAAAA,GAAAA,MAAAA;AACAA,OAAO,CAAPA,KAAAA,GAAAA,KAAAA;AACAA,OAAO,CAAPA,OAAAA,GAAAA,OAAAA;AACAA,OAAO,CAAPA,MAAAA,GAAAA,MAAAA","sourcesContent":["import React, {\n  Fragment,\n  createContext,\n  createRef,\n  useCallback,\n  useContext,\n  useMemo,\n  useReducer,\n  useRef,\n\n  // Types\n  Dispatch,\n  ElementType,\n  KeyboardEvent as ReactKeyboardEvent,\n  MouseEvent as ReactMouseEvent,\n  MutableRefObject,\n  Ref,\n} from 'react'\n\nimport { useDisposables } from '../../hooks/use-disposables'\nimport { useId } from '../../hooks/use-id'\nimport { useIsoMorphicEffect } from '../../hooks/use-iso-morphic-effect'\nimport { useComputed } from '../../hooks/use-computed'\nimport { useSyncRefs } from '../../hooks/use-sync-refs'\nimport { Props } from '../../types'\nimport { Features, forwardRefWithAs, PropsForFeatures, render } from '../../utils/render'\nimport { match } from '../../utils/match'\nimport { disposables } from '../../utils/disposables'\nimport { Keys } from '../keyboard'\nimport { Focus, calculateActiveIndex } from '../../utils/calculate-active-index'\nimport { isDisabledReactIssue7711 } from '../../utils/bugs'\nimport { isFocusableElement, FocusableMode } from '../../utils/focus-management'\nimport { useWindowEvent } from '../../hooks/use-window-event'\nimport { useOpenClosed, State, OpenClosedProvider } from '../../internal/open-closed'\nimport { useResolveButtonType } from '../../hooks/use-resolve-button-type'\n\nenum ListboxStates {\n  Open,\n  Closed,\n}\n\ntype ListboxOptionDataRef = MutableRefObject<{\n  textValue?: string\n  disabled: boolean\n  value: unknown\n}>\n\ninterface StateDefinition {\n  listboxState: ListboxStates\n\n  orientation: 'horizontal' | 'vertical'\n\n  propsRef: MutableRefObject<{ value: unknown; onChange(value: unknown): void }>\n  labelRef: MutableRefObject<HTMLLabelElement | null>\n  buttonRef: MutableRefObject<HTMLButtonElement | null>\n  optionsRef: MutableRefObject<HTMLUListElement | null>\n\n  disabled: boolean\n  options: { id: string; dataRef: ListboxOptionDataRef }[]\n  searchQuery: string\n  activeOptionIndex: number | null\n}\n\nenum ActionTypes {\n  OpenListbox,\n  CloseListbox,\n\n  SetDisabled,\n  SetOrientation,\n\n  GoToOption,\n  Search,\n  ClearSearch,\n\n  RegisterOption,\n  UnregisterOption,\n}\n\ntype Actions =\n  | { type: ActionTypes.CloseListbox }\n  | { type: ActionTypes.OpenListbox }\n  | { type: ActionTypes.SetDisabled; disabled: boolean }\n  | { type: ActionTypes.SetOrientation; orientation: StateDefinition['orientation'] }\n  | { type: ActionTypes.GoToOption; focus: Focus.Specific; id: string }\n  | { type: ActionTypes.GoToOption; focus: Exclude<Focus, Focus.Specific> }\n  | { type: ActionTypes.Search; value: string }\n  | { type: ActionTypes.ClearSearch }\n  | { type: ActionTypes.RegisterOption; id: string; dataRef: ListboxOptionDataRef }\n  | { type: ActionTypes.UnregisterOption; id: string }\n\nlet reducers: {\n  [P in ActionTypes]: (\n    state: StateDefinition,\n    action: Extract<Actions, { type: P }>\n  ) => StateDefinition\n} = {\n  [ActionTypes.CloseListbox](state) {\n    if (state.disabled) return state\n    if (state.listboxState === ListboxStates.Closed) return state\n    return { ...state, activeOptionIndex: null, listboxState: ListboxStates.Closed }\n  },\n  [ActionTypes.OpenListbox](state) {\n    if (state.disabled) return state\n    if (state.listboxState === ListboxStates.Open) return state\n    return { ...state, listboxState: ListboxStates.Open }\n  },\n  [ActionTypes.SetDisabled](state, action) {\n    if (state.disabled === action.disabled) return state\n    return { ...state, disabled: action.disabled }\n  },\n  [ActionTypes.SetOrientation](state, action) {\n    if (state.orientation === action.orientation) return state\n    return { ...state, orientation: action.orientation }\n  },\n  [ActionTypes.GoToOption](state, action) {\n    if (state.disabled) return state\n    if (state.listboxState === ListboxStates.Closed) return state\n\n    let activeOptionIndex = calculateActiveIndex(action, {\n      resolveItems: () => state.options,\n      resolveActiveIndex: () => state.activeOptionIndex,\n      resolveId: item => item.id,\n      resolveDisabled: item => item.dataRef.current.disabled,\n    })\n\n    if (state.searchQuery === '' && state.activeOptionIndex === activeOptionIndex) return state\n    return { ...state, searchQuery: '', activeOptionIndex }\n  },\n  [ActionTypes.Search]: (state, action) => {\n    if (state.disabled) return state\n    if (state.listboxState === ListboxStates.Closed) return state\n\n    let searchQuery = state.searchQuery + action.value.toLowerCase()\n    let match = state.options.findIndex(\n      option =>\n        !option.dataRef.current.disabled &&\n        option.dataRef.current.textValue?.startsWith(searchQuery)\n    )\n\n    if (match === -1 || match === state.activeOptionIndex) return { ...state, searchQuery }\n    return { ...state, searchQuery, activeOptionIndex: match }\n  },\n  [ActionTypes.ClearSearch](state) {\n    if (state.disabled) return state\n    if (state.listboxState === ListboxStates.Closed) return state\n    if (state.searchQuery === '') return state\n    return { ...state, searchQuery: '' }\n  },\n  [ActionTypes.RegisterOption]: (state, action) => ({\n    ...state,\n    options: [...state.options, { id: action.id, dataRef: action.dataRef }],\n  }),\n  [ActionTypes.UnregisterOption]: (state, action) => {\n    let nextOptions = state.options.slice()\n    let currentActiveOption =\n      state.activeOptionIndex !== null ? nextOptions[state.activeOptionIndex] : null\n\n    let idx = nextOptions.findIndex(a => a.id === action.id)\n\n    if (idx !== -1) nextOptions.splice(idx, 1)\n\n    return {\n      ...state,\n      options: nextOptions,\n      activeOptionIndex: (() => {\n        if (idx === state.activeOptionIndex) return null\n        if (currentActiveOption === null) return null\n\n        // If we removed the option before the actual active index, then it would be out of sync. To\n        // fix this, we will find the correct (new) index position.\n        return nextOptions.indexOf(currentActiveOption)\n      })(),\n    }\n  },\n}\n\nlet ListboxContext = createContext<[StateDefinition, Dispatch<Actions>] | null>(null)\nListboxContext.displayName = 'ListboxContext'\n\nfunction useListboxContext(component: string) {\n  let context = useContext(ListboxContext)\n  if (context === null) {\n    let err = new Error(`<${component} /> is missing a parent <${Listbox.name} /> component.`)\n    if (Error.captureStackTrace) Error.captureStackTrace(err, useListboxContext)\n    throw err\n  }\n  return context\n}\n\nfunction stateReducer(state: StateDefinition, action: Actions) {\n  return match(action.type, reducers, state, action)\n}\n\n// ---\n\nlet DEFAULT_LISTBOX_TAG = Fragment\ninterface ListboxRenderPropArg {\n  open: boolean\n  disabled: boolean\n}\n\nexport function Listbox<TTag extends ElementType = typeof DEFAULT_LISTBOX_TAG, TType = string>(\n  props: Props<TTag, ListboxRenderPropArg, 'value' | 'onChange'> & {\n    value: TType\n    onChange(value: TType): void\n    disabled?: boolean\n    horizontal?: boolean\n  }\n) {\n  let { value, onChange, disabled = false, horizontal = false, ...passThroughProps } = props\n  const orientation = horizontal ? 'horizontal' : 'vertical'\n\n  let reducerBag = useReducer(stateReducer, {\n    listboxState: ListboxStates.Closed,\n    propsRef: { current: { value, onChange } },\n    labelRef: createRef(),\n    buttonRef: createRef(),\n    optionsRef: createRef(),\n    disabled,\n    orientation,\n    options: [],\n    searchQuery: '',\n    activeOptionIndex: null,\n  } as StateDefinition)\n  let [{ listboxState, propsRef, optionsRef, buttonRef }, dispatch] = reducerBag\n\n  useIsoMorphicEffect(() => {\n    propsRef.current.value = value\n  }, [value, propsRef])\n  useIsoMorphicEffect(() => {\n    propsRef.current.onChange = onChange\n  }, [onChange, propsRef])\n  useIsoMorphicEffect(() => dispatch({ type: ActionTypes.SetDisabled, disabled }), [disabled])\n  useIsoMorphicEffect(() => dispatch({ type: ActionTypes.SetOrientation, orientation }), [\n    orientation,\n  ])\n\n  // Handle outside click\n  useWindowEvent('mousedown', event => {\n    let target = event.target as HTMLElement\n\n    if (listboxState !== ListboxStates.Open) return\n\n    if (buttonRef.current?.contains(target)) return\n    if (optionsRef.current?.contains(target)) return\n\n    dispatch({ type: ActionTypes.CloseListbox })\n\n    if (!isFocusableElement(target, FocusableMode.Loose)) {\n      event.preventDefault()\n      buttonRef.current?.focus()\n    }\n  })\n\n  let slot = useMemo<ListboxRenderPropArg>(\n    () => ({ open: listboxState === ListboxStates.Open, disabled }),\n    [listboxState, disabled]\n  )\n\n  return (\n    <ListboxContext.Provider value={reducerBag}>\n      <OpenClosedProvider\n        value={match(listboxState, {\n          [ListboxStates.Open]: State.Open,\n          [ListboxStates.Closed]: State.Closed,\n        })}\n      >\n        {render({\n          props: passThroughProps,\n          slot,\n          defaultTag: DEFAULT_LISTBOX_TAG,\n          name: 'Listbox',\n        })}\n      </OpenClosedProvider>\n    </ListboxContext.Provider>\n  )\n}\n\n// ---\n\nlet DEFAULT_BUTTON_TAG = 'button' as const\ninterface ButtonRenderPropArg {\n  open: boolean\n  disabled: boolean\n}\ntype ButtonPropsWeControl =\n  | 'id'\n  | 'type'\n  | 'aria-haspopup'\n  | 'aria-controls'\n  | 'aria-expanded'\n  | 'aria-labelledby'\n  | 'disabled'\n  | 'onKeyDown'\n  | 'onClick'\n\nlet Button = forwardRefWithAs(function Button<TTag extends ElementType = typeof DEFAULT_BUTTON_TAG>(\n  props: Props<TTag, ButtonRenderPropArg, ButtonPropsWeControl>,\n  ref: Ref<HTMLButtonElement>\n) {\n  let [state, dispatch] = useListboxContext([Listbox.name, Button.name].join('.'))\n  let buttonRef = useSyncRefs(state.buttonRef, ref)\n\n  let id = `headlessui-listbox-button-${useId()}`\n  let d = useDisposables()\n\n  let handleKeyDown = useCallback(\n    (event: ReactKeyboardEvent<HTMLButtonElement>) => {\n      switch (event.key) {\n        // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-13\n\n        case Keys.Space:\n        case Keys.Enter:\n        case Keys.ArrowDown:\n          event.preventDefault()\n          dispatch({ type: ActionTypes.OpenListbox })\n          d.nextFrame(() => {\n            if (!state.propsRef.current.value)\n              dispatch({ type: ActionTypes.GoToOption, focus: Focus.First })\n          })\n          break\n\n        case Keys.ArrowUp:\n          event.preventDefault()\n          dispatch({ type: ActionTypes.OpenListbox })\n          d.nextFrame(() => {\n            if (!state.propsRef.current.value)\n              dispatch({ type: ActionTypes.GoToOption, focus: Focus.Last })\n          })\n          break\n      }\n    },\n    [dispatch, state, d]\n  )\n\n  let handleKeyUp = useCallback((event: ReactKeyboardEvent<HTMLButtonElement>) => {\n    switch (event.key) {\n      case Keys.Space:\n        // Required for firefox, event.preventDefault() in handleKeyDown for\n        // the Space key doesn't cancel the handleKeyUp, which in turn\n        // triggers a *click*.\n        event.preventDefault()\n        break\n    }\n  }, [])\n\n  let handleClick = useCallback(\n    (event: ReactMouseEvent) => {\n      if (isDisabledReactIssue7711(event.currentTarget)) return event.preventDefault()\n      if (state.listboxState === ListboxStates.Open) {\n        dispatch({ type: ActionTypes.CloseListbox })\n        d.nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n      } else {\n        event.preventDefault()\n        dispatch({ type: ActionTypes.OpenListbox })\n      }\n    },\n    [dispatch, d, state]\n  )\n\n  let labelledby = useComputed(() => {\n    if (!state.labelRef.current) return undefined\n    return [state.labelRef.current.id, id].join(' ')\n  }, [state.labelRef.current, id])\n\n  let slot = useMemo<ButtonRenderPropArg>(\n    () => ({ open: state.listboxState === ListboxStates.Open, disabled: state.disabled }),\n    [state]\n  )\n  let passthroughProps = props\n  let propsWeControl = {\n    ref: buttonRef,\n    id,\n    type: useResolveButtonType(props, state.buttonRef),\n    'aria-haspopup': true,\n    'aria-controls': state.optionsRef.current?.id,\n    'aria-expanded': state.disabled ? undefined : state.listboxState === ListboxStates.Open,\n    'aria-labelledby': labelledby,\n    disabled: state.disabled,\n    onKeyDown: handleKeyDown,\n    onKeyUp: handleKeyUp,\n    onClick: handleClick,\n  }\n\n  return render({\n    props: { ...passthroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_BUTTON_TAG,\n    name: 'Listbox.Button',\n  })\n})\n\n// ---\n\nlet DEFAULT_LABEL_TAG = 'label' as const\ninterface LabelRenderPropArg {\n  open: boolean\n  disabled: boolean\n}\ntype LabelPropsWeControl = 'id' | 'ref' | 'onClick'\n\nfunction Label<TTag extends ElementType = typeof DEFAULT_LABEL_TAG>(\n  props: Props<TTag, LabelRenderPropArg, LabelPropsWeControl>\n) {\n  let [state] = useListboxContext([Listbox.name, Label.name].join('.'))\n  let id = `headlessui-listbox-label-${useId()}`\n\n  let handleClick = useCallback(() => state.buttonRef.current?.focus({ preventScroll: true }), [\n    state.buttonRef,\n  ])\n\n  let slot = useMemo<LabelRenderPropArg>(\n    () => ({ open: state.listboxState === ListboxStates.Open, disabled: state.disabled }),\n    [state]\n  )\n  let propsWeControl = { ref: state.labelRef, id, onClick: handleClick }\n  return render({\n    props: { ...props, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_LABEL_TAG,\n    name: 'Listbox.Label',\n  })\n}\n\n// ---\n\nlet DEFAULT_OPTIONS_TAG = 'ul' as const\ninterface OptionsRenderPropArg {\n  open: boolean\n}\ntype OptionsPropsWeControl =\n  | 'aria-activedescendant'\n  | 'aria-labelledby'\n  | 'aria-orientation'\n  | 'id'\n  | 'onKeyDown'\n  | 'role'\n  | 'tabIndex'\n\nlet OptionsRenderFeatures = Features.RenderStrategy | Features.Static\n\nlet Options = forwardRefWithAs(function Options<\n  TTag extends ElementType = typeof DEFAULT_OPTIONS_TAG\n>(\n  props: Props<TTag, OptionsRenderPropArg, OptionsPropsWeControl> &\n    PropsForFeatures<typeof OptionsRenderFeatures>,\n  ref: Ref<HTMLUListElement>\n) {\n  let [state, dispatch] = useListboxContext([Listbox.name, Options.name].join('.'))\n  let optionsRef = useSyncRefs(state.optionsRef, ref)\n\n  let id = `headlessui-listbox-options-${useId()}`\n  let d = useDisposables()\n  let searchDisposables = useDisposables()\n\n  let usesOpenClosedState = useOpenClosed()\n  let visible = (() => {\n    if (usesOpenClosedState !== null) {\n      return usesOpenClosedState === State.Open\n    }\n\n    return state.listboxState === ListboxStates.Open\n  })()\n\n  useIsoMorphicEffect(() => {\n    let container = state.optionsRef.current\n    if (!container) return\n    if (state.listboxState !== ListboxStates.Open) return\n    if (container === document.activeElement) return\n\n    container.focus({ preventScroll: true })\n  }, [state.listboxState, state.optionsRef])\n\n  let handleKeyDown = useCallback(\n    (event: ReactKeyboardEvent<HTMLUListElement>) => {\n      searchDisposables.dispose()\n\n      switch (event.key) {\n        // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-12\n\n        // @ts-expect-error Fallthrough is expected here\n        case Keys.Space:\n          if (state.searchQuery !== '') {\n            event.preventDefault()\n            event.stopPropagation()\n            return dispatch({ type: ActionTypes.Search, value: event.key })\n          }\n        // When in type ahead mode, fallthrough\n        case Keys.Enter:\n          event.preventDefault()\n          event.stopPropagation()\n          dispatch({ type: ActionTypes.CloseListbox })\n          if (state.activeOptionIndex !== null) {\n            let { dataRef } = state.options[state.activeOptionIndex]\n            state.propsRef.current.onChange(dataRef.current.value)\n          }\n          disposables().nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n          break\n\n        case match(state.orientation, { vertical: Keys.ArrowDown, horizontal: Keys.ArrowRight }):\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToOption, focus: Focus.Next })\n\n        case match(state.orientation, { vertical: Keys.ArrowUp, horizontal: Keys.ArrowLeft }):\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToOption, focus: Focus.Previous })\n\n        case Keys.Home:\n        case Keys.PageUp:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToOption, focus: Focus.First })\n\n        case Keys.End:\n        case Keys.PageDown:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToOption, focus: Focus.Last })\n\n        case Keys.Escape:\n          event.preventDefault()\n          event.stopPropagation()\n          dispatch({ type: ActionTypes.CloseListbox })\n          return d.nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n\n        case Keys.Tab:\n          event.preventDefault()\n          event.stopPropagation()\n          break\n\n        default:\n          if (event.key.length === 1) {\n            dispatch({ type: ActionTypes.Search, value: event.key })\n            searchDisposables.setTimeout(() => dispatch({ type: ActionTypes.ClearSearch }), 350)\n          }\n          break\n      }\n    },\n    [d, dispatch, searchDisposables, state]\n  )\n\n  let labelledby = useComputed(() => state.labelRef.current?.id ?? state.buttonRef.current?.id, [\n    state.labelRef.current,\n    state.buttonRef.current,\n  ])\n\n  let slot = useMemo<OptionsRenderPropArg>(\n    () => ({ open: state.listboxState === ListboxStates.Open }),\n    [state]\n  )\n  let propsWeControl = {\n    'aria-activedescendant':\n      state.activeOptionIndex === null ? undefined : state.options[state.activeOptionIndex]?.id,\n    'aria-labelledby': labelledby,\n    'aria-orientation': state.orientation,\n    id,\n    onKeyDown: handleKeyDown,\n    role: 'listbox',\n    tabIndex: 0,\n    ref: optionsRef,\n  }\n  let passthroughProps = props\n\n  return render({\n    props: { ...passthroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_OPTIONS_TAG,\n    features: OptionsRenderFeatures,\n    visible,\n    name: 'Listbox.Options',\n  })\n})\n\n// ---\n\nlet DEFAULT_OPTION_TAG = 'li' as const\ninterface OptionRenderPropArg {\n  active: boolean\n  selected: boolean\n  disabled: boolean\n}\ntype ListboxOptionPropsWeControl =\n  | 'id'\n  | 'role'\n  | 'tabIndex'\n  | 'aria-disabled'\n  | 'aria-selected'\n  | 'onPointerLeave'\n  | 'onMouseLeave'\n  | 'onPointerMove'\n  | 'onMouseMove'\n  | 'onFocus'\n\nfunction Option<\n  TTag extends ElementType = typeof DEFAULT_OPTION_TAG,\n  // TODO: One day we will be able to infer this type from the generic in Listbox itself.\n  // But today is not that day..\n  TType = Parameters<typeof Listbox>[0]['value']\n>(\n  props: Props<TTag, OptionRenderPropArg, ListboxOptionPropsWeControl | 'value'> & {\n    disabled?: boolean\n    value: TType\n  }\n) {\n  let { disabled = false, value, ...passthroughProps } = props\n  let [state, dispatch] = useListboxContext([Listbox.name, Option.name].join('.'))\n  let id = `headlessui-listbox-option-${useId()}`\n  let active =\n    state.activeOptionIndex !== null ? state.options[state.activeOptionIndex].id === id : false\n  let selected = state.propsRef.current.value === value\n\n  let bag = useRef<ListboxOptionDataRef['current']>({ disabled, value })\n\n  useIsoMorphicEffect(() => {\n    bag.current.disabled = disabled\n  }, [bag, disabled])\n  useIsoMorphicEffect(() => {\n    bag.current.value = value\n  }, [bag, value])\n  useIsoMorphicEffect(() => {\n    bag.current.textValue = document.getElementById(id)?.textContent?.toLowerCase()\n  }, [bag, id])\n\n  let select = useCallback(() => state.propsRef.current.onChange(value), [state.propsRef, value])\n\n  useIsoMorphicEffect(() => {\n    dispatch({ type: ActionTypes.RegisterOption, id, dataRef: bag })\n    return () => dispatch({ type: ActionTypes.UnregisterOption, id })\n  }, [bag, id])\n\n  useIsoMorphicEffect(() => {\n    if (state.listboxState !== ListboxStates.Open) return\n    if (!selected) return\n    dispatch({ type: ActionTypes.GoToOption, focus: Focus.Specific, id })\n    document.getElementById(id)?.focus?.()\n  }, [state.listboxState])\n\n  useIsoMorphicEffect(() => {\n    if (state.listboxState !== ListboxStates.Open) return\n    if (!active) return\n    let d = disposables()\n    d.nextFrame(() => document.getElementById(id)?.scrollIntoView?.({ block: 'nearest' }))\n    return d.dispose\n  }, [id, active, state.listboxState])\n\n  let handleClick = useCallback(\n    (event: { preventDefault: Function }) => {\n      if (disabled) return event.preventDefault()\n      select()\n      dispatch({ type: ActionTypes.CloseListbox })\n      disposables().nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n    },\n    [dispatch, state.buttonRef, disabled, select]\n  )\n\n  let handleFocus = useCallback(() => {\n    if (disabled) return dispatch({ type: ActionTypes.GoToOption, focus: Focus.Nothing })\n    dispatch({ type: ActionTypes.GoToOption, focus: Focus.Specific, id })\n  }, [disabled, id, dispatch])\n\n  let handleMove = useCallback(() => {\n    if (disabled) return\n    if (active) return\n    dispatch({ type: ActionTypes.GoToOption, focus: Focus.Specific, id })\n  }, [disabled, active, id, dispatch])\n\n  let handleLeave = useCallback(() => {\n    if (disabled) return\n    if (!active) return\n    dispatch({ type: ActionTypes.GoToOption, focus: Focus.Nothing })\n  }, [disabled, active, dispatch])\n\n  let slot = useMemo<OptionRenderPropArg>(() => ({ active, selected, disabled }), [\n    active,\n    selected,\n    disabled,\n  ])\n  let propsWeControl = {\n    id,\n    role: 'option',\n    tabIndex: disabled === true ? undefined : -1,\n    'aria-disabled': disabled === true ? true : undefined,\n    'aria-selected': selected === true ? true : undefined,\n    disabled: undefined, // Never forward the `disabled` prop\n    onClick: handleClick,\n    onFocus: handleFocus,\n    onPointerMove: handleMove,\n    onMouseMove: handleMove,\n    onPointerLeave: handleLeave,\n    onMouseLeave: handleLeave,\n  }\n\n  return render({\n    props: { ...passthroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_OPTION_TAG,\n    name: 'Listbox.Option',\n  })\n}\n\n// ---\n\nListbox.Button = Button\nListbox.Label = Label\nListbox.Options = Options\nListbox.Option = Option\n"]},"metadata":{},"sourceType":"module"}