{"ast":null,"code":"import { extends as _extends, objectWithoutPropertiesLoose as _objectWithoutPropertiesLoose } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport React, { useReducer, createRef, useMemo, createContext, useCallback, useEffect, useRef, useContext, Fragment } from 'react';\nimport { match } from '../../utils/match.esm.js';\nimport { render, forwardRefWithAs, Features } from '../../utils/render.esm.js';\nimport { useSyncRefs } from '../../hooks/use-sync-refs.esm.js';\nimport { Keys } from '../keyboard.esm.js';\nimport { isDisabledReactIssue7711 } from '../../utils/bugs.esm.js';\nimport { useIsoMorphicEffect } from '../../hooks/use-iso-morphic-effect.esm.js';\nimport { useId } from '../../hooks/use-id.esm.js';\nimport { isFocusableElement, FocusableMode } from '../../utils/focus-management.esm.js';\nimport { useWindowEvent } from '../../hooks/use-window-event.esm.js';\nimport { OpenClosedProvider, State, useOpenClosed } from '../../internal/open-closed.esm.js';\nimport { useResolveButtonType } from '../../hooks/use-resolve-button-type.esm.js';\nimport { disposables } from '../../utils/disposables.esm.js';\nimport { useDisposables } from '../../hooks/use-disposables.esm.js';\nimport { calculateActiveIndex, Focus } from '../../utils/calculate-active-index.esm.js';\nimport { useTreeWalker } from '../../hooks/use-tree-walker.esm.js';\n\nvar _reducers;\n\nvar MenuStates;\n\n(function (MenuStates) {\n  MenuStates[MenuStates[\"Open\"] = 0] = \"Open\";\n  MenuStates[MenuStates[\"Closed\"] = 1] = \"Closed\";\n})(MenuStates || (MenuStates = {}));\n\nvar ActionTypes;\n\n(function (ActionTypes) {\n  ActionTypes[ActionTypes[\"OpenMenu\"] = 0] = \"OpenMenu\";\n  ActionTypes[ActionTypes[\"CloseMenu\"] = 1] = \"CloseMenu\";\n  ActionTypes[ActionTypes[\"GoToItem\"] = 2] = \"GoToItem\";\n  ActionTypes[ActionTypes[\"Search\"] = 3] = \"Search\";\n  ActionTypes[ActionTypes[\"ClearSearch\"] = 4] = \"ClearSearch\";\n  ActionTypes[ActionTypes[\"RegisterItem\"] = 5] = \"RegisterItem\";\n  ActionTypes[ActionTypes[\"UnregisterItem\"] = 6] = \"UnregisterItem\";\n})(ActionTypes || (ActionTypes = {}));\n\nvar reducers = (_reducers = {}, _reducers[ActionTypes.CloseMenu] = function (state) {\n  if (state.menuState === MenuStates.Closed) return state;\n  return _extends({}, state, {\n    activeItemIndex: null,\n    menuState: MenuStates.Closed\n  });\n}, _reducers[ActionTypes.OpenMenu] = function (state) {\n  if (state.menuState === MenuStates.Open) return state;\n  return _extends({}, state, {\n    menuState: MenuStates.Open\n  });\n}, _reducers[ActionTypes.GoToItem] = function (state, action) {\n  var activeItemIndex = calculateActiveIndex(action, {\n    resolveItems: function resolveItems() {\n      return state.items;\n    },\n    resolveActiveIndex: function resolveActiveIndex() {\n      return state.activeItemIndex;\n    },\n    resolveId: function resolveId(item) {\n      return item.id;\n    },\n    resolveDisabled: function resolveDisabled(item) {\n      return item.dataRef.current.disabled;\n    }\n  });\n  if (state.searchQuery === '' && state.activeItemIndex === activeItemIndex) return state;\n  return _extends({}, state, {\n    searchQuery: '',\n    activeItemIndex: activeItemIndex\n  });\n}, _reducers[ActionTypes.Search] = function (state, action) {\n  var searchQuery = state.searchQuery + action.value.toLowerCase();\n  var match = state.items.findIndex(function (item) {\n    var _item$dataRef$current;\n\n    return ((_item$dataRef$current = item.dataRef.current.textValue) == null ? void 0 : _item$dataRef$current.startsWith(searchQuery)) && !item.dataRef.current.disabled;\n  });\n  if (match === -1 || match === state.activeItemIndex) return _extends({}, state, {\n    searchQuery: searchQuery\n  });\n  return _extends({}, state, {\n    searchQuery: searchQuery,\n    activeItemIndex: match\n  });\n}, _reducers[ActionTypes.ClearSearch] = function (state) {\n  if (state.searchQuery === '') return state;\n  return _extends({}, state, {\n    searchQuery: ''\n  });\n}, _reducers[ActionTypes.RegisterItem] = function (state, action) {\n  return _extends({}, state, {\n    items: [].concat(state.items, [{\n      id: action.id,\n      dataRef: action.dataRef\n    }])\n  });\n}, _reducers[ActionTypes.UnregisterItem] = function (state, action) {\n  var nextItems = state.items.slice();\n  var currentActiveItem = state.activeItemIndex !== null ? nextItems[state.activeItemIndex] : null;\n  var idx = nextItems.findIndex(function (a) {\n    return a.id === action.id;\n  });\n  if (idx !== -1) nextItems.splice(idx, 1);\n  return _extends({}, state, {\n    items: nextItems,\n    activeItemIndex: function () {\n      if (idx === state.activeItemIndex) return null;\n      if (currentActiveItem === null) return null; // If we removed the item before the actual active index, then it would be out of sync. To\n      // fix this, we will find the correct (new) index position.\n\n      return nextItems.indexOf(currentActiveItem);\n    }()\n  });\n}, _reducers);\nvar MenuContext = /*#__PURE__*/createContext(null);\nMenuContext.displayName = 'MenuContext';\n\nfunction useMenuContext(component) {\n  var context = useContext(MenuContext);\n\n  if (context === null) {\n    var err = new Error(\"<\" + component + \" /> is missing a parent <\" + Menu.name + \" /> component.\");\n    if (Error.captureStackTrace) Error.captureStackTrace(err, useMenuContext);\n    throw err;\n  }\n\n  return context;\n}\n\nfunction stateReducer(state, action) {\n  return match(action.type, reducers, state, action);\n} // ---\n\n\nvar DEFAULT_MENU_TAG = Fragment;\n\nfunction Menu(props) {\n  var _match;\n\n  var reducerBag = useReducer(stateReducer, {\n    menuState: MenuStates.Closed,\n    buttonRef: createRef(),\n    itemsRef: createRef(),\n    items: [],\n    searchQuery: '',\n    activeItemIndex: null\n  });\n  var _reducerBag$ = reducerBag[0],\n      menuState = _reducerBag$.menuState,\n      itemsRef = _reducerBag$.itemsRef,\n      buttonRef = _reducerBag$.buttonRef,\n      dispatch = reducerBag[1]; // Handle outside click\n\n  useWindowEvent('mousedown', function (event) {\n    var _buttonRef$current, _itemsRef$current;\n\n    var target = event.target;\n    if (menuState !== MenuStates.Open) return;\n    if ((_buttonRef$current = buttonRef.current) == null ? void 0 : _buttonRef$current.contains(target)) return;\n    if ((_itemsRef$current = itemsRef.current) == null ? void 0 : _itemsRef$current.contains(target)) return;\n    dispatch({\n      type: ActionTypes.CloseMenu\n    });\n\n    if (!isFocusableElement(target, FocusableMode.Loose)) {\n      var _buttonRef$current2;\n\n      event.preventDefault();\n      (_buttonRef$current2 = buttonRef.current) == null ? void 0 : _buttonRef$current2.focus();\n    }\n  });\n  var slot = useMemo(function () {\n    return {\n      open: menuState === MenuStates.Open\n    };\n  }, [menuState]);\n  return React.createElement(MenuContext.Provider, {\n    value: reducerBag\n  }, React.createElement(OpenClosedProvider, {\n    value: match(menuState, (_match = {}, _match[MenuStates.Open] = State.Open, _match[MenuStates.Closed] = State.Closed, _match))\n  }, render({\n    props: props,\n    slot: slot,\n    defaultTag: DEFAULT_MENU_TAG,\n    name: 'Menu'\n  })));\n} // ---\n\n\nvar DEFAULT_BUTTON_TAG = 'button';\nvar Button = /*#__PURE__*/forwardRefWithAs(function Button(props, ref) {\n  var _state$itemsRef$curre;\n\n  var _useMenuContext = useMenuContext([Menu.name, Button.name].join('.')),\n      state = _useMenuContext[0],\n      dispatch = _useMenuContext[1];\n\n  var buttonRef = useSyncRefs(state.buttonRef, ref);\n  var id = \"headlessui-menu-button-\" + useId();\n  var d = useDisposables();\n  var handleKeyDown = useCallback(function (event) {\n    switch (event.key) {\n      // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-13\n      case Keys.Space:\n      case Keys.Enter:\n      case Keys.ArrowDown:\n        event.preventDefault();\n        event.stopPropagation();\n        dispatch({\n          type: ActionTypes.OpenMenu\n        });\n        d.nextFrame(function () {\n          return dispatch({\n            type: ActionTypes.GoToItem,\n            focus: Focus.First\n          });\n        });\n        break;\n\n      case Keys.ArrowUp:\n        event.preventDefault();\n        event.stopPropagation();\n        dispatch({\n          type: ActionTypes.OpenMenu\n        });\n        d.nextFrame(function () {\n          return dispatch({\n            type: ActionTypes.GoToItem,\n            focus: Focus.Last\n          });\n        });\n        break;\n    }\n  }, [dispatch, d]);\n  var handleKeyUp = useCallback(function (event) {\n    switch (event.key) {\n      case Keys.Space:\n        // Required for firefox, event.preventDefault() in handleKeyDown for\n        // the Space key doesn't cancel the handleKeyUp, which in turn\n        // triggers a *click*.\n        event.preventDefault();\n        break;\n    }\n  }, []);\n  var handleClick = useCallback(function (event) {\n    if (isDisabledReactIssue7711(event.currentTarget)) return event.preventDefault();\n    if (props.disabled) return;\n\n    if (state.menuState === MenuStates.Open) {\n      dispatch({\n        type: ActionTypes.CloseMenu\n      });\n      d.nextFrame(function () {\n        var _state$buttonRef$curr;\n\n        return (_state$buttonRef$curr = state.buttonRef.current) == null ? void 0 : _state$buttonRef$curr.focus({\n          preventScroll: true\n        });\n      });\n    } else {\n      event.preventDefault();\n      event.stopPropagation();\n      dispatch({\n        type: ActionTypes.OpenMenu\n      });\n    }\n  }, [dispatch, d, state, props.disabled]);\n  var slot = useMemo(function () {\n    return {\n      open: state.menuState === MenuStates.Open\n    };\n  }, [state]);\n  var passthroughProps = props;\n  var propsWeControl = {\n    ref: buttonRef,\n    id: id,\n    type: useResolveButtonType(props, state.buttonRef),\n    'aria-haspopup': true,\n    'aria-controls': (_state$itemsRef$curre = state.itemsRef.current) == null ? void 0 : _state$itemsRef$curre.id,\n    'aria-expanded': props.disabled ? undefined : state.menuState === MenuStates.Open,\n    onKeyDown: handleKeyDown,\n    onKeyUp: handleKeyUp,\n    onClick: handleClick\n  };\n  return render({\n    props: _extends({}, passthroughProps, propsWeControl),\n    slot: slot,\n    defaultTag: DEFAULT_BUTTON_TAG,\n    name: 'Menu.Button'\n  });\n}); // ---\n\nvar DEFAULT_ITEMS_TAG = 'div';\nvar ItemsRenderFeatures = Features.RenderStrategy | Features.Static;\nvar Items = /*#__PURE__*/forwardRefWithAs(function Items(props, ref) {\n  var _state$items$state$ac, _state$buttonRef$curr4;\n\n  var _useMenuContext2 = useMenuContext([Menu.name, Items.name].join('.')),\n      state = _useMenuContext2[0],\n      dispatch = _useMenuContext2[1];\n\n  var itemsRef = useSyncRefs(state.itemsRef, ref);\n  var id = \"headlessui-menu-items-\" + useId();\n  var searchDisposables = useDisposables();\n  var usesOpenClosedState = useOpenClosed();\n\n  var visible = function () {\n    if (usesOpenClosedState !== null) {\n      return usesOpenClosedState === State.Open;\n    }\n\n    return state.menuState === MenuStates.Open;\n  }();\n\n  useEffect(function () {\n    var container = state.itemsRef.current;\n    if (!container) return;\n    if (state.menuState !== MenuStates.Open) return;\n    if (container === document.activeElement) return;\n    container.focus({\n      preventScroll: true\n    });\n  }, [state.menuState, state.itemsRef]);\n  useTreeWalker({\n    container: state.itemsRef.current,\n    enabled: state.menuState === MenuStates.Open,\n    accept: function accept(node) {\n      if (node.getAttribute('role') === 'menuitem') return NodeFilter.FILTER_REJECT;\n      if (node.hasAttribute('role')) return NodeFilter.FILTER_SKIP;\n      return NodeFilter.FILTER_ACCEPT;\n    },\n    walk: function walk(node) {\n      node.setAttribute('role', 'none');\n    }\n  });\n  var handleKeyDown = useCallback(function (event) {\n    searchDisposables.dispose();\n\n    switch (event.key) {\n      // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-12\n      // @ts-expect-error Fallthrough is expected here\n      case Keys.Space:\n        if (state.searchQuery !== '') {\n          event.preventDefault();\n          event.stopPropagation();\n          return dispatch({\n            type: ActionTypes.Search,\n            value: event.key\n          });\n        }\n\n      // When in type ahead mode, fallthrough\n\n      case Keys.Enter:\n        event.preventDefault();\n        event.stopPropagation();\n        dispatch({\n          type: ActionTypes.CloseMenu\n        });\n\n        if (state.activeItemIndex !== null) {\n          var _document$getElementB;\n\n          var _id = state.items[state.activeItemIndex].id;\n          (_document$getElementB = document.getElementById(_id)) == null ? void 0 : _document$getElementB.click();\n        }\n\n        disposables().nextFrame(function () {\n          var _state$buttonRef$curr2;\n\n          return (_state$buttonRef$curr2 = state.buttonRef.current) == null ? void 0 : _state$buttonRef$curr2.focus({\n            preventScroll: true\n          });\n        });\n        break;\n\n      case Keys.ArrowDown:\n        event.preventDefault();\n        event.stopPropagation();\n        return dispatch({\n          type: ActionTypes.GoToItem,\n          focus: Focus.Next\n        });\n\n      case Keys.ArrowUp:\n        event.preventDefault();\n        event.stopPropagation();\n        return dispatch({\n          type: ActionTypes.GoToItem,\n          focus: Focus.Previous\n        });\n\n      case Keys.Home:\n      case Keys.PageUp:\n        event.preventDefault();\n        event.stopPropagation();\n        return dispatch({\n          type: ActionTypes.GoToItem,\n          focus: Focus.First\n        });\n\n      case Keys.End:\n      case Keys.PageDown:\n        event.preventDefault();\n        event.stopPropagation();\n        return dispatch({\n          type: ActionTypes.GoToItem,\n          focus: Focus.Last\n        });\n\n      case Keys.Escape:\n        event.preventDefault();\n        event.stopPropagation();\n        dispatch({\n          type: ActionTypes.CloseMenu\n        });\n        disposables().nextFrame(function () {\n          var _state$buttonRef$curr3;\n\n          return (_state$buttonRef$curr3 = state.buttonRef.current) == null ? void 0 : _state$buttonRef$curr3.focus({\n            preventScroll: true\n          });\n        });\n        break;\n\n      case Keys.Tab:\n        event.preventDefault();\n        event.stopPropagation();\n        break;\n\n      default:\n        if (event.key.length === 1) {\n          dispatch({\n            type: ActionTypes.Search,\n            value: event.key\n          });\n          searchDisposables.setTimeout(function () {\n            return dispatch({\n              type: ActionTypes.ClearSearch\n            });\n          }, 350);\n        }\n\n        break;\n    }\n  }, [dispatch, searchDisposables, state]);\n  var handleKeyUp = useCallback(function (event) {\n    switch (event.key) {\n      case Keys.Space:\n        // Required for firefox, event.preventDefault() in handleKeyDown for\n        // the Space key doesn't cancel the handleKeyUp, which in turn\n        // triggers a *click*.\n        event.preventDefault();\n        break;\n    }\n  }, []);\n  var slot = useMemo(function () {\n    return {\n      open: state.menuState === MenuStates.Open\n    };\n  }, [state]);\n  var propsWeControl = {\n    'aria-activedescendant': state.activeItemIndex === null ? undefined : (_state$items$state$ac = state.items[state.activeItemIndex]) == null ? void 0 : _state$items$state$ac.id,\n    'aria-labelledby': (_state$buttonRef$curr4 = state.buttonRef.current) == null ? void 0 : _state$buttonRef$curr4.id,\n    id: id,\n    onKeyDown: handleKeyDown,\n    onKeyUp: handleKeyUp,\n    role: 'menu',\n    tabIndex: 0,\n    ref: itemsRef\n  };\n  var passthroughProps = props;\n  return render({\n    props: _extends({}, passthroughProps, propsWeControl),\n    slot: slot,\n    defaultTag: DEFAULT_ITEMS_TAG,\n    features: ItemsRenderFeatures,\n    visible: visible,\n    name: 'Menu.Items'\n  });\n}); // ---\n\nvar DEFAULT_ITEM_TAG = Fragment;\n\nfunction Item(props) {\n  var _props$disabled = props.disabled,\n      disabled = _props$disabled === void 0 ? false : _props$disabled,\n      onClick = props.onClick,\n      passthroughProps = _objectWithoutPropertiesLoose(props, [\"disabled\", \"onClick\"]);\n\n  var _useMenuContext3 = useMenuContext([Menu.name, Item.name].join('.')),\n      state = _useMenuContext3[0],\n      dispatch = _useMenuContext3[1];\n\n  var id = \"headlessui-menu-item-\" + useId();\n  var active = state.activeItemIndex !== null ? state.items[state.activeItemIndex].id === id : false;\n  useIsoMorphicEffect(function () {\n    if (state.menuState !== MenuStates.Open) return;\n    if (!active) return;\n    var d = disposables();\n    d.nextFrame(function () {\n      var _document$getElementB2;\n\n      return (_document$getElementB2 = document.getElementById(id)) == null ? void 0 : _document$getElementB2.scrollIntoView == null ? void 0 : _document$getElementB2.scrollIntoView({\n        block: 'nearest'\n      });\n    });\n    return d.dispose;\n  }, [id, active, state.menuState]);\n  var bag = useRef({\n    disabled: disabled\n  });\n  useIsoMorphicEffect(function () {\n    bag.current.disabled = disabled;\n  }, [bag, disabled]);\n  useIsoMorphicEffect(function () {\n    var _document$getElementB3, _document$getElementB4;\n\n    bag.current.textValue = (_document$getElementB3 = document.getElementById(id)) == null ? void 0 : (_document$getElementB4 = _document$getElementB3.textContent) == null ? void 0 : _document$getElementB4.toLowerCase();\n  }, [bag, id]);\n  useIsoMorphicEffect(function () {\n    dispatch({\n      type: ActionTypes.RegisterItem,\n      id: id,\n      dataRef: bag\n    });\n    return function () {\n      return dispatch({\n        type: ActionTypes.UnregisterItem,\n        id: id\n      });\n    };\n  }, [bag, id]);\n  var handleClick = useCallback(function (event) {\n    if (disabled) return event.preventDefault();\n    dispatch({\n      type: ActionTypes.CloseMenu\n    });\n    disposables().nextFrame(function () {\n      var _state$buttonRef$curr5;\n\n      return (_state$buttonRef$curr5 = state.buttonRef.current) == null ? void 0 : _state$buttonRef$curr5.focus({\n        preventScroll: true\n      });\n    });\n    if (onClick) return onClick(event);\n  }, [dispatch, state.buttonRef, disabled, onClick]);\n  var handleFocus = useCallback(function () {\n    if (disabled) return dispatch({\n      type: ActionTypes.GoToItem,\n      focus: Focus.Nothing\n    });\n    dispatch({\n      type: ActionTypes.GoToItem,\n      focus: Focus.Specific,\n      id: id\n    });\n  }, [disabled, id, dispatch]);\n  var handleMove = useCallback(function () {\n    if (disabled) return;\n    if (active) return;\n    dispatch({\n      type: ActionTypes.GoToItem,\n      focus: Focus.Specific,\n      id: id\n    });\n  }, [disabled, active, id, dispatch]);\n  var handleLeave = useCallback(function () {\n    if (disabled) return;\n    if (!active) return;\n    dispatch({\n      type: ActionTypes.GoToItem,\n      focus: Focus.Nothing\n    });\n  }, [disabled, active, dispatch]);\n  var slot = useMemo(function () {\n    return {\n      active: active,\n      disabled: disabled\n    };\n  }, [active, disabled]);\n  var propsWeControl = {\n    id: id,\n    role: 'menuitem',\n    tabIndex: disabled === true ? undefined : -1,\n    'aria-disabled': disabled === true ? true : undefined,\n    disabled: undefined,\n    onClick: handleClick,\n    onFocus: handleFocus,\n    onPointerMove: handleMove,\n    onMouseMove: handleMove,\n    onPointerLeave: handleLeave,\n    onMouseLeave: handleLeave\n  };\n  return render({\n    props: _extends({}, passthroughProps, propsWeControl),\n    slot: slot,\n    defaultTag: DEFAULT_ITEM_TAG,\n    name: 'Menu.Item'\n  });\n} // ---\n\n\nMenu.Button = Button;\nMenu.Items = Items;\nMenu.Item = Item;\nexport { Menu };","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;AAsCA,IAAKA,UAAL;;AAAA,WAAKA,UAAL,EAAKA;EACHA;EACAA;AAFF,GAAKA,UAAU,KAAVA,UAAU,MAAf;;AAgBA,IAAKC,WAAL;;AAAA,WAAKA,WAAL,EAAKA;EACHA;EACAA;EAEAA;EACAA;EACAA;EACAA;EACAA;AARF,GAAKA,WAAW,KAAXA,WAAW,MAAhB;;AAqBA,IAAIC,QAAQ,8BAMTD,WAAW,CAACE,SANH,cAMcC,KANd;EAOR,IAAIA,KAAK,CAACC,SAAND,KAAoBJ,UAAU,CAACM,MAAnC,EAA2C,OAAOF,KAAP;EAC3C,oBAAYA,KAAZ;IAAmBG,eAAe,EAAE,IAApC;IAA0CF,SAAS,EAAEL,UAAU,CAACM;EAAhE;AARQ,aAUTL,WAAW,CAACO,QAVH,cAUaJ,KAVb;EAWR,IAAIA,KAAK,CAACC,SAAND,KAAoBJ,UAAU,CAACS,IAAnC,EAAyC,OAAOL,KAAP;EACzC,oBAAYA,KAAZ;IAAmBC,SAAS,EAAEL,UAAU,CAACS;EAAzC;AAZQ,aAcTR,WAAW,CAACS,QAdH,IAcc,UAACN,KAAD,EAAQO,MAAR;EACtB,IAAIJ,eAAe,GAAGK,oBAAoB,CAACD,MAAD,EAAS;IACjDE,YAAY,EAAE;MAAA,OAAMT,KAAK,CAACU,KAAZ;IADmC;IAEjDC,kBAAkB,EAAE;MAAA,OAAMX,KAAK,CAACG,eAAZ;IAF6B;IAGjDS,SAAS,EAAE,yBAAI;MAAA,OAAIC,IAAI,CAACC,EAAT;IAHkC;IAIjDC,eAAe,EAAE,+BAAI;MAAA,OAAIF,IAAI,CAACG,OAALH,CAAaI,OAAbJ,CAAqBK,QAAzB;IAAA;EAJ4B,CAAT,CAA1C;EAOA,IAAIlB,KAAK,CAACmB,WAANnB,KAAsB,EAAtBA,IAA4BA,KAAK,CAACG,eAANH,KAA0BG,eAA1D,EAA2E,OAAOH,KAAP;EAC3E,oBAAYA,KAAZ;IAAmBmB,WAAW,EAAE,EAAhC;IAAoChB,eAAe,EAAfA;EAApC;AAvBQ,aAyBTN,WAAW,CAACuB,MAzBH,IAyBY,UAACpB,KAAD,EAAQO,MAAR;EACpB,IAAIY,WAAW,GAAGnB,KAAK,CAACmB,WAANnB,GAAoBO,MAAM,CAACc,KAAPd,CAAae,WAAbf,EAAtC;EACA,IAAIgB,KAAK,GAAGvB,KAAK,CAACU,KAANV,CAAYwB,SAAZxB,CACV,gBAAI;IAAA;;IAAA,OACF,8BAAI,CAACgB,OAALH,CAAaI,OAAbJ,CAAqBY,SAArB,2CAAgCC,UAAhC,CAA2CP,WAA3C,MAA2D,CAACN,IAAI,CAACG,OAALH,CAAaI,OAAbJ,CAAqBK,QAD/E;EADM,EAAZ;EAKA,IAAIK,KAAK,KAAK,CAAC,CAAXA,IAAgBA,KAAK,KAAKvB,KAAK,CAACG,eAApC,EAAqD,oBAAYH,KAAZ;IAAmBmB,WAAW,EAAXA;EAAnB;EACrD,oBAAYnB,KAAZ;IAAmBmB,WAAW,EAAXA,WAAnB;IAAgChB,eAAe,EAAEoB;EAAjD;AAjCQ,aAmCT1B,WAAW,CAAC8B,WAnCH,cAmCgB3B,KAnChB;EAoCR,IAAIA,KAAK,CAACmB,WAANnB,KAAsB,EAA1B,EAA8B,OAAOA,KAAP;EAC9B,oBAAYA,KAAZ;IAAmBmB,WAAW,EAAE;EAAhC;AArCQ,aAuCTtB,WAAW,CAAC+B,YAvCH,IAuCkB,UAAC5B,KAAD,EAAQO,MAAR;EAAA,oBACvBP,KADuB;IAE1BU,KAAK,YAAMV,KAAK,CAACU,KAAZ,GAAmB;MAAEI,EAAE,EAAEP,MAAM,CAACO,EAAb;MAAiBE,OAAO,EAAET,MAAM,CAACS;IAAjC,CAAnB;EAFqB;AAvClB,aA2CTnB,WAAW,CAACgC,cA3CH,IA2CoB,UAAC7B,KAAD,EAAQO,MAAR;EAC5B,IAAIuB,SAAS,GAAG9B,KAAK,CAACU,KAANV,CAAY+B,KAAZ/B,EAAhB;EACA,IAAIgC,iBAAiB,GAAGhC,KAAK,CAACG,eAANH,KAA0B,IAA1BA,GAAiC8B,SAAS,CAAC9B,KAAK,CAACG,eAAP,CAA1CH,GAAoE,IAA5F;EAEA,IAAIiC,GAAG,GAAGH,SAAS,CAACN,SAAVM,CAAoB,aAAC;IAAA,OAAII,CAAC,CAACpB,EAAFoB,KAAS3B,MAAM,CAACO,EAApB;EAArB,EAAV;EAEA,IAAImB,GAAG,KAAK,CAAC,CAAb,EAAgBH,SAAS,CAACK,MAAVL,CAAiBG,GAAjBH,EAAsB,CAAtBA;EAEhB,oBACK9B,KADL;IAEEU,KAAK,EAAEoB,SAFT;IAGE3B,eAAe,EAAG;MAChB,IAAI8B,GAAG,KAAKjC,KAAK,CAACG,eAAlB,EAAmC,OAAO,IAAP;MACnC,IAAI6B,iBAAiB,KAAK,IAA1B,EAAgC,OAAO,IAAP,CAFhB,CAEgB;MAGhC;;MACA,OAAOF,SAAS,CAACM,OAAVN,CAAkBE,iBAAlBF,CAAP;IANe,CAAC;EAHpB;AAnDQ,aAAZ;AAkEA,IAAIO,WAAW,gBAAGC,aAAa,CAA8C,IAA9C,CAA/B;AACAD,WAAW,CAACE,WAAZF,GAA0B,aAA1BA;;AAEA,SAASG,cAAT,CAAwBC,SAAxB;EACE,IAAIC,OAAO,GAAGC,UAAU,CAACN,WAAD,CAAxB;;EACA,IAAIK,OAAO,KAAK,IAAhB,EAAsB;IACpB,IAAIE,GAAG,GAAG,IAAIC,KAAJ,OAAcJ,SAAd,iCAAmDK,IAAI,CAACC,IAAxD,oBAAV;IACA,IAAIF,KAAK,CAACG,iBAAV,EAA6BH,KAAK,CAACG,iBAANH,CAAwBD,GAAxBC,EAA6BL,cAA7BK;IAC7B,MAAMD,GAAN;EACD;;EACD,OAAOF,OAAP;AACD;;AAED,SAASO,YAAT,CAAsBjD,KAAtB,EAA8CO,MAA9C;EACE,OAAOgB,KAAK,CAAChB,MAAM,CAAC2C,IAAR,EAAcpD,QAAd,EAAwBE,KAAxB,EAA+BO,MAA/B,CAAZ;AACD,C,CAAA;;;AAID,IAAI4C,gBAAgB,GAAGC,QAAvB;;SAKgBN,KACdO;;;EAEA,IAAIC,UAAU,GAAGC,UAAU,CAACN,YAAD,EAAe;IACxChD,SAAS,EAAEL,UAAU,CAACM,MADkB;IAExCsD,SAAS,EAAEC,SAAS,EAFoB;IAGxCC,QAAQ,EAAED,SAAS,EAHqB;IAIxC/C,KAAK,EAAE,EAJiC;IAKxCS,WAAW,EAAE,EAL2B;IAMxChB,eAAe,EAAE;EANuB,CAAf,CAA3B;qBAQqDmD;MAA9CrD;MAAWyD;MAAUF;MAAaG,WAAYL,cAVrDD,CAUqDC;;EAGrDM,cAAc,CAAC,WAAD,EAAc,iBAAK;;;IAC/B,IAAIC,MAAM,GAAGC,KAAK,CAACD,MAAnB;IAEA,IAAI5D,SAAS,KAAKL,UAAU,CAACS,IAA7B,EAAmC;IAEnC,0BAAImD,SAAS,CAACvC,OAAd,qBAAI8C,mBAAmBC,QAAnB,CAA4BH,MAA5B,CAAJ,EAAyC;IACzC,yBAAIH,QAAQ,CAACzC,OAAb,qBAAIgD,kBAAkBD,QAAlB,CAA2BH,MAA3B,CAAJ,EAAwC;IAExCF,QAAQ,CAAC;MAAET,IAAI,EAAErD,WAAW,CAACE;IAApB,CAAD,CAAR4D;;IAEA,IAAI,CAACO,kBAAkB,CAACL,MAAD,EAASM,aAAa,CAACC,KAAvB,CAAvB,EAAsD;MAAA;;MACpDN,KAAK,CAACO,cAANP;MACA,gCAAS,CAAC7C,OAAV,yCAAmBqD,KAAnB;IACD;EAbW,EAAdV;EAgBA,IAAIW,IAAI,GAAGC,OAAO,CAAoB;IAAA,OAAO;MAAEC,IAAI,EAAExE,SAAS,KAAKL,UAAU,CAACS;IAAjC,CAAP;EAApB,GAAqE,CACrFJ,SADqF,CAArE,CAAlB;EAIA,OACEyE,oBAACrC,WAAW,CAACsC,QAAbD;IAAsBrD,KAAK,EAAEiC;EAA7B,GACEoB,oBAACE,kBAADF;IACErD,KAAK,EAAEE,KAAK,CAACtB,SAAD,uBACTL,UAAU,CAACS,IADF,IACSwE,KAAK,CAACxE,IADf,SAETT,UAAU,CAACM,MAFF,IAEW2E,KAAK,CAAC3E,MAFjB;EADd,GAMG4E,MAAM,CAAC;IAAEzB,KAAK,EAALA,KAAF;IAASkB,IAAI,EAAJA,IAAT;IAAeQ,UAAU,EAAE5B,gBAA3B;IAA6CJ,IAAI,EAAE;EAAnD,CAAD,CANT2B,CADFA,CADF;AAYD,C,CAAA;;;AAID,IAAIM,kBAAkB,GAAG,QAAzB;AAaA,IAAIC,MAAM,gBAAGC,gBAAgB,CAAC,SAASD,MAAT,CAC5B5B,KAD4B,EAE5B8B,GAF4B;;;wBAIJ3C,cAAc,CAAC,CAACM,IAAI,CAACC,IAAN,EAAYkC,MAAM,CAAClC,IAAnB,EAAyBqC,IAAzB,CAA8B,GAA9B,CAAD;MAAjCpF;MAAO2D;;EACZ,IAAIH,SAAS,GAAG6B,WAAW,CAACrF,KAAK,CAACwD,SAAP,EAAkB2B,GAAlB,CAA3B;EAEA,IAAIrE,EAAE,+BAA6BwE,KAAK,EAAxC;EACA,IAAIC,CAAC,GAAGC,cAAc,EAAtB;EAEA,IAAIC,aAAa,GAAGC,WAAW,CAC7B,UAAC5B,KAAD;IACE,QAAQA,KAAK,CAAC6B,GAAd;MACE;MAEA,KAAKC,IAAI,CAACC,KAAV;MACA,KAAKD,IAAI,CAACE,KAAV;MACA,KAAKF,IAAI,CAACG,SAAV;QACEjC,KAAK,CAACO,cAANP;QACAA,KAAK,CAACkC,eAANlC;QACAH,QAAQ,CAAC;UAAET,IAAI,EAAErD,WAAW,CAACO;QAApB,CAAD,CAARuD;QACA4B,CAAC,CAACU,SAAFV,CAAY;UAAA,OAAM5B,QAAQ,CAAC;YAAET,IAAI,EAAErD,WAAW,CAACS,QAApB;YAA8BgE,KAAK,EAAE4B,KAAK,CAACC;UAA3C,CAAD,CAAd;QAAZ;QACA;;MAEF,KAAKP,IAAI,CAACQ,OAAV;QACEtC,KAAK,CAACO,cAANP;QACAA,KAAK,CAACkC,eAANlC;QACAH,QAAQ,CAAC;UAAET,IAAI,EAAErD,WAAW,CAACO;QAApB,CAAD,CAARuD;QACA4B,CAAC,CAACU,SAAFV,CAAY;UAAA,OAAM5B,QAAQ,CAAC;YAAET,IAAI,EAAErD,WAAW,CAACS,QAApB;YAA8BgE,KAAK,EAAE4B,KAAK,CAACG;UAA3C,CAAD,CAAd;QAAZ;QACA;IAjBJ;EAF2B,GAsB7B,CAAC1C,QAAD,EAAW4B,CAAX,CAtB6B,CAA/B;EAyBA,IAAIe,WAAW,GAAGZ,WAAW,CAAC,UAAC5B,KAAD;IAC5B,QAAQA,KAAK,CAAC6B,GAAd;MACE,KAAKC,IAAI,CAACC,KAAV;QACE;QACA;QACA;QACA/B,KAAK,CAACO,cAANP;QACA;IANJ;EAD2B,GAS1B,EAT0B,CAA7B;EAWA,IAAIyC,WAAW,GAAGb,WAAW,CAC3B,UAAC5B,KAAD;IACE,IAAI0C,wBAAwB,CAAC1C,KAAK,CAAC2C,aAAP,CAA5B,EAAmD,OAAO3C,KAAK,CAACO,cAANP,EAAP;IACnD,IAAIT,KAAK,CAACnC,QAAV,EAAoB;;IACpB,IAAIlB,KAAK,CAACC,SAAND,KAAoBJ,UAAU,CAACS,IAAnC,EAAyC;MACvCsD,QAAQ,CAAC;QAAET,IAAI,EAAErD,WAAW,CAACE;MAApB,CAAD,CAAR4D;MACA4B,CAAC,CAACU,SAAFV,CAAY;QAAA;;QAAA,gCAAMvF,KAAK,CAACwD,SAANxD,CAAgBiB,OAAtB,qBAAMyF,sBAAyBpC,KAAzB,CAA+B;UAAEqC,aAAa,EAAE;QAAjB,CAA/B,CAAN;MAAZ;IAFF,OAGO;MACL7C,KAAK,CAACO,cAANP;MACAA,KAAK,CAACkC,eAANlC;MACAH,QAAQ,CAAC;QAAET,IAAI,EAAErD,WAAW,CAACO;MAApB,CAAD,CAARuD;IACD;EAXwB,GAa3B,CAACA,QAAD,EAAW4B,CAAX,EAAcvF,KAAd,EAAqBqD,KAAK,CAACnC,QAA3B,CAb2B,CAA7B;EAgBA,IAAIqD,IAAI,GAAGC,OAAO,CAAsB;IAAA,OAAO;MAAEC,IAAI,EAAEzE,KAAK,CAACC,SAAND,KAAoBJ,UAAU,CAACS;IAAvC,CAAP;EAAtB,GAA6E,CAC7FL,KAD6F,CAA7E,CAAlB;EAGA,IAAI4G,gBAAgB,GAAGvD,KAAvB;EACA,IAAIwD,cAAc,GAAG;IACnB1B,GAAG,EAAE3B,SADc;IAEnB1C,EAAE,EAAFA,EAFmB;IAGnBoC,IAAI,EAAE4D,oBAAoB,CAACzD,KAAD,EAAQrD,KAAK,CAACwD,SAAd,CAHP;IAInB,iBAAiB,IAJE;IAKnB,0CAAiBxD,KAAK,CAAC0D,QAAN1D,CAAeiB,OAAhC,qBAAiB8F,sBAAwBjG,EALtB;IAMnB,iBAAiBuC,KAAK,CAACnC,QAANmC,GAAiB2D,SAAjB3D,GAA6BrD,KAAK,CAACC,SAAND,KAAoBJ,UAAU,CAACS,IAN1D;IAOnB4G,SAAS,EAAExB,aAPQ;IAQnByB,OAAO,EAAEZ,WARU;IASnBa,OAAO,EAAEZ;EATU,CAArB;EAYA,OAAOzB,MAAM,CAAC;IACZzB,KAAK,eAAOuD,gBAAP,EAA4BC,cAA5B,CADO;IAEZtC,IAAI,EAAJA,IAFY;IAGZQ,UAAU,EAAEC,kBAHA;IAIZjC,IAAI,EAAE;EAJM,CAAD,CAAb;AA9E2B,EAA7B,C,CAAA;;AAwFA,IAAIqE,iBAAiB,GAAG,KAAxB;AAYA,IAAIC,mBAAmB,GAAGC,QAAQ,CAACC,cAATD,GAA0BA,QAAQ,CAACE,MAA7D;AAEA,IAAIC,KAAK,gBAAGvC,gBAAgB,CAAC,SAASuC,KAAT,CAC3BpE,KAD2B,EAG3B8B,GAH2B;;;yBAKH3C,cAAc,CAAC,CAACM,IAAI,CAACC,IAAN,EAAY0E,KAAK,CAAC1E,IAAlB,EAAwBqC,IAAxB,CAA6B,GAA7B,CAAD;MAAjCpF;MAAO2D;;EACZ,IAAID,QAAQ,GAAG2B,WAAW,CAACrF,KAAK,CAAC0D,QAAP,EAAiByB,GAAjB,CAA1B;EAEA,IAAIrE,EAAE,8BAA4BwE,KAAK,EAAvC;EACA,IAAIoC,iBAAiB,GAAGlC,cAAc,EAAtC;EAEA,IAAImC,mBAAmB,GAAGC,aAAa,EAAvC;;EACA,IAAIC,OAAO,GAAI;IACb,IAAIF,mBAAmB,KAAK,IAA5B,EAAkC;MAChC,OAAOA,mBAAmB,KAAK9C,KAAK,CAACxE,IAArC;IACD;;IAED,OAAOL,KAAK,CAACC,SAAND,KAAoBJ,UAAU,CAACS,IAAtC;EALY,CAAC,EAAf;;EAQAyH,SAAS,CAAC;IACR,IAAIC,SAAS,GAAG/H,KAAK,CAAC0D,QAAN1D,CAAeiB,OAA/B;IACA,IAAI,CAAC8G,SAAL,EAAgB;IAChB,IAAI/H,KAAK,CAACC,SAAND,KAAoBJ,UAAU,CAACS,IAAnC,EAAyC;IACzC,IAAI0H,SAAS,KAAKC,QAAQ,CAACC,aAA3B,EAA0C;IAE1CF,SAAS,CAACzD,KAAVyD,CAAgB;MAAEpB,aAAa,EAAE;IAAjB,CAAhBoB;EANO,GAON,CAAC/H,KAAK,CAACC,SAAP,EAAkBD,KAAK,CAAC0D,QAAxB,CAPM,CAAToE;EASAI,aAAa,CAAC;IACZH,SAAS,EAAE/H,KAAK,CAAC0D,QAAN1D,CAAeiB,OADd;IAEZkH,OAAO,EAAEnI,KAAK,CAACC,SAAND,KAAoBJ,UAAU,CAACS,IAF5B;IAGZ+H,MAHY,kBAGLC,IAHK;MAIV,IAAIA,IAAI,CAACC,YAALD,CAAkB,MAAlBA,MAA8B,UAAlC,EAA8C,OAAOE,UAAU,CAACC,aAAlB;MAC9C,IAAIH,IAAI,CAACI,YAALJ,CAAkB,MAAlBA,CAAJ,EAA+B,OAAOE,UAAU,CAACG,WAAlB;MAC/B,OAAOH,UAAU,CAACI,aAAlB;IANU;IAQZC,IARY,gBAQPP,IARO;MASVA,IAAI,CAACQ,YAALR,CAAkB,MAAlBA,EAA0B,MAA1BA;IACD;EAVW,CAAD,CAAbH;EAaA,IAAIzC,aAAa,GAAGC,WAAW,CAC7B,UAAC5B,KAAD;IACE4D,iBAAiB,CAACoB,OAAlBpB;;IAEA,QAAQ5D,KAAK,CAAC6B,GAAd;MACE;MAEA;MACA,KAAKC,IAAI,CAACC,KAAV;QACE,IAAI7F,KAAK,CAACmB,WAANnB,KAAsB,EAA1B,EAA8B;UAC5B8D,KAAK,CAACO,cAANP;UACAA,KAAK,CAACkC,eAANlC;UACA,OAAOH,QAAQ,CAAC;YAAET,IAAI,EAAErD,WAAW,CAACuB,MAApB;YAA4BC,KAAK,EAAEyC,KAAK,CAAC6B;UAAzC,CAAD,CAAf;QACD;;MACH;;MACA,KAAKC,IAAI,CAACE,KAAV;QACEhC,KAAK,CAACO,cAANP;QACAA,KAAK,CAACkC,eAANlC;QACAH,QAAQ,CAAC;UAAET,IAAI,EAAErD,WAAW,CAACE;QAApB,CAAD,CAAR4D;;QACA,IAAI3D,KAAK,CAACG,eAANH,KAA0B,IAA9B,EAAoC;UAAA;;UAAA,IAC5Bc,GAD4B,GACrBd,KAAK,CAACU,KAANV,CAAYA,KAAK,CAACG,eAAlBH,EAAPc,EAD4B;UAElC,iCAAQ,CAACiI,cAATf,CAAwBlH,GAAxBkH,4CAA6BgB,KAA7B;QACD;;QACDC,WAAW,GAAGhD,SAAdgD,CAAwB;UAAA;;UAAA,iCAAMjJ,KAAK,CAACwD,SAANxD,CAAgBiB,OAAtB,qBAAMiI,uBAAyB5E,KAAzB,CAA+B;YAAEqC,aAAa,EAAE;UAAjB,CAA/B,CAAN;QAAxB;QACA;;MAEF,KAAKf,IAAI,CAACG,SAAV;QACEjC,KAAK,CAACO,cAANP;QACAA,KAAK,CAACkC,eAANlC;QACA,OAAOH,QAAQ,CAAC;UAAET,IAAI,EAAErD,WAAW,CAACS,QAApB;UAA8BgE,KAAK,EAAE4B,KAAK,CAACiD;QAA3C,CAAD,CAAf;;MAEF,KAAKvD,IAAI,CAACQ,OAAV;QACEtC,KAAK,CAACO,cAANP;QACAA,KAAK,CAACkC,eAANlC;QACA,OAAOH,QAAQ,CAAC;UAAET,IAAI,EAAErD,WAAW,CAACS,QAApB;UAA8BgE,KAAK,EAAE4B,KAAK,CAACkD;QAA3C,CAAD,CAAf;;MAEF,KAAKxD,IAAI,CAACyD,IAAV;MACA,KAAKzD,IAAI,CAAC0D,MAAV;QACExF,KAAK,CAACO,cAANP;QACAA,KAAK,CAACkC,eAANlC;QACA,OAAOH,QAAQ,CAAC;UAAET,IAAI,EAAErD,WAAW,CAACS,QAApB;UAA8BgE,KAAK,EAAE4B,KAAK,CAACC;QAA3C,CAAD,CAAf;;MAEF,KAAKP,IAAI,CAAC2D,GAAV;MACA,KAAK3D,IAAI,CAAC4D,QAAV;QACE1F,KAAK,CAACO,cAANP;QACAA,KAAK,CAACkC,eAANlC;QACA,OAAOH,QAAQ,CAAC;UAAET,IAAI,EAAErD,WAAW,CAACS,QAApB;UAA8BgE,KAAK,EAAE4B,KAAK,CAACG;QAA3C,CAAD,CAAf;;MAEF,KAAKT,IAAI,CAAC6D,MAAV;QACE3F,KAAK,CAACO,cAANP;QACAA,KAAK,CAACkC,eAANlC;QACAH,QAAQ,CAAC;UAAET,IAAI,EAAErD,WAAW,CAACE;QAApB,CAAD,CAAR4D;QACAsF,WAAW,GAAGhD,SAAdgD,CAAwB;UAAA;;UAAA,iCAAMjJ,KAAK,CAACwD,SAANxD,CAAgBiB,OAAtB,qBAAMyI,uBAAyBpF,KAAzB,CAA+B;YAAEqC,aAAa,EAAE;UAAjB,CAA/B,CAAN;QAAxB;QACA;;MAEF,KAAKf,IAAI,CAAC+D,GAAV;QACE7F,KAAK,CAACO,cAANP;QACAA,KAAK,CAACkC,eAANlC;QACA;;MAEF;QACE,IAAIA,KAAK,CAAC6B,GAAN7B,CAAU8F,MAAV9F,KAAqB,CAAzB,EAA4B;UAC1BH,QAAQ,CAAC;YAAET,IAAI,EAAErD,WAAW,CAACuB,MAApB;YAA4BC,KAAK,EAAEyC,KAAK,CAAC6B;UAAzC,CAAD,CAARhC;UACA+D,iBAAiB,CAACmC,UAAlBnC,CAA6B;YAAA,OAAM/D,QAAQ,CAAC;cAAET,IAAI,EAAErD,WAAW,CAAC8B;YAApB,CAAD,CAAd;UAA7B,GAAgF,GAAhF+F;QACD;;QACD;IA7DJ;EAJ2B,GAoE7B,CAAC/D,QAAD,EAAW+D,iBAAX,EAA8B1H,KAA9B,CApE6B,CAA/B;EAuEA,IAAIsG,WAAW,GAAGZ,WAAW,CAAC,UAAC5B,KAAD;IAC5B,QAAQA,KAAK,CAAC6B,GAAd;MACE,KAAKC,IAAI,CAACC,KAAV;QACE;QACA;QACA;QACA/B,KAAK,CAACO,cAANP;QACA;IANJ;EAD2B,GAS1B,EAT0B,CAA7B;EAWA,IAAIS,IAAI,GAAGC,OAAO,CAAqB;IAAA,OAAO;MAAEC,IAAI,EAAEzE,KAAK,CAACC,SAAND,KAAoBJ,UAAU,CAACS;IAAvC,CAAP;EAArB,GAA4E,CAC5FL,KAD4F,CAA5E,CAAlB;EAGA,IAAI6G,cAAc,GAAG;IACnB,yBACE7G,KAAK,CAACG,eAANH,KAA0B,IAA1BA,GAAiCgH,SAAjChH,4BAA6CA,KAAK,CAACU,KAANV,CAAYA,KAAK,CAACG,eAAlBH,CAA7C,qBAA6C8J,sBAAoChJ,EAFhE;IAGnB,6CAAmBd,KAAK,CAACwD,SAANxD,CAAgBiB,OAAnC,qBAAmB8I,uBAAyBjJ,EAHzB;IAInBA,EAAE,EAAFA,EAJmB;IAKnBmG,SAAS,EAAExB,aALQ;IAMnByB,OAAO,EAAEZ,WANU;IAOnB0D,IAAI,EAAE,MAPa;IAQnBC,QAAQ,EAAE,CARS;IASnB9E,GAAG,EAAEzB;EATc,CAArB;EAWA,IAAIkD,gBAAgB,GAAGvD,KAAvB;EAEA,OAAOyB,MAAM,CAAC;IACZzB,KAAK,eAAOuD,gBAAP,EAA4BC,cAA5B,CADO;IAEZtC,IAAI,EAAJA,IAFY;IAGZQ,UAAU,EAAEqC,iBAHA;IAIZ8C,QAAQ,EAAE7C,mBAJE;IAKZQ,OAAO,EAAPA,OALY;IAMZ9E,IAAI,EAAE;EANM,CAAD,CAAb;AA5I0B,EAA5B,C,CAAA;;AAwJA,IAAIoH,gBAAgB,GAAG/G,QAAvB;;AAgBA,SAASgH,IAAT,CACE/G,KADF;wBAM2DA,MAAnDnC;MAAAA,wCAAW,KAAXA,GAAWmJ;MAAOlD,UAAiC9D,MAAjC8D;MAAYP,iDAAqBvD,KAArBuD,EAAqBvD,uBAArBuD;;yBACZpE,cAAc,CAAC,CAACM,IAAI,CAACC,IAAN,EAAYqH,IAAI,CAACrH,IAAjB,EAAuBqC,IAAvB,CAA4B,GAA5B,CAAD;MAAjCpF;MAAO2D;;EACZ,IAAI7C,EAAE,6BAA2BwE,KAAK,EAAtC;EACA,IAAIgF,MAAM,GAAGtK,KAAK,CAACG,eAANH,KAA0B,IAA1BA,GAAiCA,KAAK,CAACU,KAANV,CAAYA,KAAK,CAACG,eAAlBH,EAAmCc,EAAnCd,KAA0Cc,EAA3Ed,GAAgF,KAA7F;EAEAuK,mBAAmB,CAAC;IAClB,IAAIvK,KAAK,CAACC,SAAND,KAAoBJ,UAAU,CAACS,IAAnC,EAAyC;IACzC,IAAI,CAACiK,MAAL,EAAa;IACb,IAAI/E,CAAC,GAAG0D,WAAW,EAAnB;IACA1D,CAAC,CAACU,SAAFV,CAAY;MAAA;;MAAA,iCAAMyC,QAAQ,CAACe,cAATf,CAAwBlH,EAAxBkH,CAAN,qBAAMwC,uBAA6BC,cAA7B,IAAN,IAAM,GAAN,MAAM,0BAA6BA,cAA7B,CAA8C;QAAEC,KAAK,EAAE;MAAT,CAA9C,CAAN;IAAZ;IACA,OAAOnF,CAAC,CAACuD,OAAT;EALiB,GAMhB,CAAChI,EAAD,EAAKwJ,MAAL,EAAatK,KAAK,CAACC,SAAnB,CANgB,CAAnBsK;EAQA,IAAII,GAAG,GAAGC,MAAM,CAA6B;IAAE1J,QAAQ,EAARA;EAAF,CAA7B,CAAhB;EAEAqJ,mBAAmB,CAAC;IAClBI,GAAG,CAAC1J,OAAJ0J,CAAYzJ,QAAZyJ,GAAuBzJ,QAAvByJ;EADiB,GAEhB,CAACA,GAAD,EAAMzJ,QAAN,CAFgB,CAAnBqJ;EAIAA,mBAAmB,CAAC;;;IAClBI,GAAG,CAAC1J,OAAJ0J,CAAYlJ,SAAZkJ,6BAAwB3C,QAAQ,CAACe,cAATf,CAAwBlH,EAAxBkH,CAAxB,+CAAwB6C,uBAA6BC,WAArD,qBAAwBC,uBAA0CzJ,WAA1C,EAAxBqJ;EADiB,GAEhB,CAACA,GAAD,EAAM7J,EAAN,CAFgB,CAAnByJ;EAIAA,mBAAmB,CAAC;IAClB5G,QAAQ,CAAC;MAAET,IAAI,EAAErD,WAAW,CAAC+B,YAApB;MAAkCd,EAAE,EAAFA,EAAlC;MAAsCE,OAAO,EAAE2J;IAA/C,CAAD,CAARhH;IACA,OAAO;MAAA,OAAMA,QAAQ,CAAC;QAAET,IAAI,EAAErD,WAAW,CAACgC,cAApB;QAAoCf,EAAE,EAAFA;MAApC,CAAD,CAAd;IAAP;EAFiB,GAGhB,CAAC6J,GAAD,EAAM7J,EAAN,CAHgB,CAAnByJ;EAKA,IAAIhE,WAAW,GAAGb,WAAW,CAC3B,UAAC5B,KAAD;IACE,IAAI5C,QAAJ,EAAc,OAAO4C,KAAK,CAACO,cAANP,EAAP;IACdH,QAAQ,CAAC;MAAET,IAAI,EAAErD,WAAW,CAACE;IAApB,CAAD,CAAR4D;IACAsF,WAAW,GAAGhD,SAAdgD,CAAwB;MAAA;;MAAA,iCAAMjJ,KAAK,CAACwD,SAANxD,CAAgBiB,OAAtB,qBAAM+J,uBAAyB1G,KAAzB,CAA+B;QAAEqC,aAAa,EAAE;MAAjB,CAA/B,CAAN;IAAxB;IACA,IAAIQ,OAAJ,EAAa,OAAOA,OAAO,CAACrD,KAAD,CAAd;EALY,GAO3B,CAACH,QAAD,EAAW3D,KAAK,CAACwD,SAAjB,EAA4BtC,QAA5B,EAAsCiG,OAAtC,CAP2B,CAA7B;EAUA,IAAI8D,WAAW,GAAGvF,WAAW,CAAC;IAC5B,IAAIxE,QAAJ,EAAc,OAAOyC,QAAQ,CAAC;MAAET,IAAI,EAAErD,WAAW,CAACS,QAApB;MAA8BgE,KAAK,EAAE4B,KAAK,CAACgF;IAA3C,CAAD,CAAf;IACdvH,QAAQ,CAAC;MAAET,IAAI,EAAErD,WAAW,CAACS,QAApB;MAA8BgE,KAAK,EAAE4B,KAAK,CAACiF,QAA3C;MAAqDrK,EAAE,EAAFA;IAArD,CAAD,CAAR6C;EAF2B,GAG1B,CAACzC,QAAD,EAAWJ,EAAX,EAAe6C,QAAf,CAH0B,CAA7B;EAKA,IAAIyH,UAAU,GAAG1F,WAAW,CAAC;IAC3B,IAAIxE,QAAJ,EAAc;IACd,IAAIoJ,MAAJ,EAAY;IACZ3G,QAAQ,CAAC;MAAET,IAAI,EAAErD,WAAW,CAACS,QAApB;MAA8BgE,KAAK,EAAE4B,KAAK,CAACiF,QAA3C;MAAqDrK,EAAE,EAAFA;IAArD,CAAD,CAAR6C;EAH0B,GAIzB,CAACzC,QAAD,EAAWoJ,MAAX,EAAmBxJ,EAAnB,EAAuB6C,QAAvB,CAJyB,CAA5B;EAMA,IAAI0H,WAAW,GAAG3F,WAAW,CAAC;IAC5B,IAAIxE,QAAJ,EAAc;IACd,IAAI,CAACoJ,MAAL,EAAa;IACb3G,QAAQ,CAAC;MAAET,IAAI,EAAErD,WAAW,CAACS,QAApB;MAA8BgE,KAAK,EAAE4B,KAAK,CAACgF;IAA3C,CAAD,CAARvH;EAH2B,GAI1B,CAACzC,QAAD,EAAWoJ,MAAX,EAAmB3G,QAAnB,CAJ0B,CAA7B;EAMA,IAAIY,IAAI,GAAGC,OAAO,CAAoB;IAAA,OAAO;MAAE8F,MAAM,EAANA,MAAF;MAAUpJ,QAAQ,EAARA;IAAV,CAAP;EAApB,GAAkD,CAACoJ,MAAD,EAASpJ,QAAT,CAAlD,CAAlB;EACA,IAAI2F,cAAc,GAAG;IACnB/F,EAAE,EAAFA,EADmB;IAEnBkJ,IAAI,EAAE,UAFa;IAGnBC,QAAQ,EAAE/I,QAAQ,KAAK,IAAbA,GAAoB8F,SAApB9F,GAAgC,CAAC,CAHxB;IAInB,iBAAiBA,QAAQ,KAAK,IAAbA,GAAoB,IAApBA,GAA2B8F,SAJzB;IAKnB9F,QAAQ,EAAE8F,SALS;IAMnBG,OAAO,EAAEZ,WANU;IAOnB+E,OAAO,EAAEL,WAPU;IAQnBM,aAAa,EAAEH,UARI;IASnBI,WAAW,EAAEJ,UATM;IAUnBK,cAAc,EAAEJ,WAVG;IAWnBK,YAAY,EAAEL;EAXK,CAArB;EAcA,OAAOvG,MAAM,CAAC;IACZzB,KAAK,eAAOuD,gBAAP,EAA4BC,cAA5B,CADO;IAEZtC,IAAI,EAAJA,IAFY;IAGZQ,UAAU,EAAEoF,gBAHA;IAIZpH,IAAI,EAAE;EAJM,CAAD,CAAb;AAMD,C,CAAA;;;AAIDD,IAAI,CAACmC,MAALnC,GAAcmC,MAAdnC;AACAA,IAAI,CAAC2E,KAAL3E,GAAa2E,KAAb3E;AACAA,IAAI,CAACsH,IAALtH,GAAYsH,IAAZtH","names":["MenuStates","ActionTypes","reducers","CloseMenu","state","menuState","Closed","activeItemIndex","OpenMenu","Open","GoToItem","action","calculateActiveIndex","resolveItems","items","resolveActiveIndex","resolveId","item","id","resolveDisabled","dataRef","current","disabled","searchQuery","Search","value","toLowerCase","match","findIndex","textValue","startsWith","ClearSearch","RegisterItem","UnregisterItem","nextItems","slice","currentActiveItem","idx","a","splice","indexOf","MenuContext","createContext","displayName","useMenuContext","component","context","useContext","err","Error","Menu","name","captureStackTrace","stateReducer","type","DEFAULT_MENU_TAG","Fragment","props","reducerBag","useReducer","buttonRef","createRef","itemsRef","dispatch","useWindowEvent","target","event","_buttonRef$current","contains","_itemsRef$current","isFocusableElement","FocusableMode","Loose","preventDefault","focus","slot","useMemo","open","React","Provider","OpenClosedProvider","State","render","defaultTag","DEFAULT_BUTTON_TAG","Button","forwardRefWithAs","ref","join","useSyncRefs","useId","d","useDisposables","handleKeyDown","useCallback","key","Keys","Space","Enter","ArrowDown","stopPropagation","nextFrame","Focus","First","ArrowUp","Last","handleKeyUp","handleClick","isDisabledReactIssue7711","currentTarget","_state$buttonRef$curr","preventScroll","passthroughProps","propsWeControl","useResolveButtonType","_state$itemsRef$curre","undefined","onKeyDown","onKeyUp","onClick","DEFAULT_ITEMS_TAG","ItemsRenderFeatures","Features","RenderStrategy","Static","Items","searchDisposables","usesOpenClosedState","useOpenClosed","visible","useEffect","container","document","activeElement","useTreeWalker","enabled","accept","node","getAttribute","NodeFilter","FILTER_REJECT","hasAttribute","FILTER_SKIP","FILTER_ACCEPT","walk","setAttribute","dispose","getElementById","click","disposables","_state$buttonRef$curr2","Next","Previous","Home","PageUp","End","PageDown","Escape","_state$buttonRef$curr3","Tab","length","setTimeout","_state$items$state$ac","_state$buttonRef$curr4","role","tabIndex","features","DEFAULT_ITEM_TAG","Item","_props$disabled","active","useIsoMorphicEffect","_document$getElementB2","scrollIntoView","block","bag","useRef","_document$getElementB3","textContent","_document$getElementB4","_state$buttonRef$curr5","handleFocus","Nothing","Specific","handleMove","handleLeave","onFocus","onPointerMove","onMouseMove","onPointerLeave","onMouseLeave"],"sources":["../../../src/components/menu/menu.tsx"],"sourcesContent":["// WAI-ARIA: https://www.w3.org/TR/wai-aria-practices-1.2/#menubutton\nimport React, {\n  Fragment,\n  createContext,\n  createRef,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useReducer,\n  useRef,\n\n  // Types\n  Dispatch,\n  ElementType,\n  KeyboardEvent as ReactKeyboardEvent,\n  MouseEvent as ReactMouseEvent,\n  MutableRefObject,\n  Ref,\n} from 'react'\n\nimport { Props } from '../../types'\nimport { match } from '../../utils/match'\nimport { forwardRefWithAs, render, Features, PropsForFeatures } from '../../utils/render'\nimport { disposables } from '../../utils/disposables'\nimport { useDisposables } from '../../hooks/use-disposables'\nimport { useIsoMorphicEffect } from '../../hooks/use-iso-morphic-effect'\nimport { useSyncRefs } from '../../hooks/use-sync-refs'\nimport { useId } from '../../hooks/use-id'\nimport { Keys } from '../keyboard'\nimport { Focus, calculateActiveIndex } from '../../utils/calculate-active-index'\nimport { isDisabledReactIssue7711 } from '../../utils/bugs'\nimport { isFocusableElement, FocusableMode } from '../../utils/focus-management'\nimport { useWindowEvent } from '../../hooks/use-window-event'\nimport { useTreeWalker } from '../../hooks/use-tree-walker'\nimport { useOpenClosed, State, OpenClosedProvider } from '../../internal/open-closed'\nimport { useResolveButtonType } from '../../hooks/use-resolve-button-type'\n\nenum MenuStates {\n  Open,\n  Closed,\n}\n\ntype MenuItemDataRef = MutableRefObject<{ textValue?: string; disabled: boolean }>\n\ninterface StateDefinition {\n  menuState: MenuStates\n  buttonRef: MutableRefObject<HTMLButtonElement | null>\n  itemsRef: MutableRefObject<HTMLDivElement | null>\n  items: { id: string; dataRef: MenuItemDataRef }[]\n  searchQuery: string\n  activeItemIndex: number | null\n}\n\nenum ActionTypes {\n  OpenMenu,\n  CloseMenu,\n\n  GoToItem,\n  Search,\n  ClearSearch,\n  RegisterItem,\n  UnregisterItem,\n}\n\ntype Actions =\n  | { type: ActionTypes.CloseMenu }\n  | { type: ActionTypes.OpenMenu }\n  | { type: ActionTypes.GoToItem; focus: Focus.Specific; id: string }\n  | { type: ActionTypes.GoToItem; focus: Exclude<Focus, Focus.Specific> }\n  | { type: ActionTypes.Search; value: string }\n  | { type: ActionTypes.ClearSearch }\n  | { type: ActionTypes.RegisterItem; id: string; dataRef: MenuItemDataRef }\n  | { type: ActionTypes.UnregisterItem; id: string }\n\nlet reducers: {\n  [P in ActionTypes]: (\n    state: StateDefinition,\n    action: Extract<Actions, { type: P }>\n  ) => StateDefinition\n} = {\n  [ActionTypes.CloseMenu](state) {\n    if (state.menuState === MenuStates.Closed) return state\n    return { ...state, activeItemIndex: null, menuState: MenuStates.Closed }\n  },\n  [ActionTypes.OpenMenu](state) {\n    if (state.menuState === MenuStates.Open) return state\n    return { ...state, menuState: MenuStates.Open }\n  },\n  [ActionTypes.GoToItem]: (state, action) => {\n    let activeItemIndex = calculateActiveIndex(action, {\n      resolveItems: () => state.items,\n      resolveActiveIndex: () => state.activeItemIndex,\n      resolveId: item => item.id,\n      resolveDisabled: item => item.dataRef.current.disabled,\n    })\n\n    if (state.searchQuery === '' && state.activeItemIndex === activeItemIndex) return state\n    return { ...state, searchQuery: '', activeItemIndex }\n  },\n  [ActionTypes.Search]: (state, action) => {\n    let searchQuery = state.searchQuery + action.value.toLowerCase()\n    let match = state.items.findIndex(\n      item =>\n        item.dataRef.current.textValue?.startsWith(searchQuery) && !item.dataRef.current.disabled\n    )\n\n    if (match === -1 || match === state.activeItemIndex) return { ...state, searchQuery }\n    return { ...state, searchQuery, activeItemIndex: match }\n  },\n  [ActionTypes.ClearSearch](state) {\n    if (state.searchQuery === '') return state\n    return { ...state, searchQuery: '' }\n  },\n  [ActionTypes.RegisterItem]: (state, action) => ({\n    ...state,\n    items: [...state.items, { id: action.id, dataRef: action.dataRef }],\n  }),\n  [ActionTypes.UnregisterItem]: (state, action) => {\n    let nextItems = state.items.slice()\n    let currentActiveItem = state.activeItemIndex !== null ? nextItems[state.activeItemIndex] : null\n\n    let idx = nextItems.findIndex(a => a.id === action.id)\n\n    if (idx !== -1) nextItems.splice(idx, 1)\n\n    return {\n      ...state,\n      items: nextItems,\n      activeItemIndex: (() => {\n        if (idx === state.activeItemIndex) return null\n        if (currentActiveItem === null) return null\n\n        // If we removed the item before the actual active index, then it would be out of sync. To\n        // fix this, we will find the correct (new) index position.\n        return nextItems.indexOf(currentActiveItem)\n      })(),\n    }\n  },\n}\n\nlet MenuContext = createContext<[StateDefinition, Dispatch<Actions>] | null>(null)\nMenuContext.displayName = 'MenuContext'\n\nfunction useMenuContext(component: string) {\n  let context = useContext(MenuContext)\n  if (context === null) {\n    let err = new Error(`<${component} /> is missing a parent <${Menu.name} /> component.`)\n    if (Error.captureStackTrace) Error.captureStackTrace(err, useMenuContext)\n    throw err\n  }\n  return context\n}\n\nfunction stateReducer(state: StateDefinition, action: Actions) {\n  return match(action.type, reducers, state, action)\n}\n\n// ---\n\nlet DEFAULT_MENU_TAG = Fragment\ninterface MenuRenderPropArg {\n  open: boolean\n}\n\nexport function Menu<TTag extends ElementType = typeof DEFAULT_MENU_TAG>(\n  props: Props<TTag, MenuRenderPropArg>\n) {\n  let reducerBag = useReducer(stateReducer, {\n    menuState: MenuStates.Closed,\n    buttonRef: createRef(),\n    itemsRef: createRef(),\n    items: [],\n    searchQuery: '',\n    activeItemIndex: null,\n  } as StateDefinition)\n  let [{ menuState, itemsRef, buttonRef }, dispatch] = reducerBag\n\n  // Handle outside click\n  useWindowEvent('mousedown', event => {\n    let target = event.target as HTMLElement\n\n    if (menuState !== MenuStates.Open) return\n\n    if (buttonRef.current?.contains(target)) return\n    if (itemsRef.current?.contains(target)) return\n\n    dispatch({ type: ActionTypes.CloseMenu })\n\n    if (!isFocusableElement(target, FocusableMode.Loose)) {\n      event.preventDefault()\n      buttonRef.current?.focus()\n    }\n  })\n\n  let slot = useMemo<MenuRenderPropArg>(() => ({ open: menuState === MenuStates.Open }), [\n    menuState,\n  ])\n\n  return (\n    <MenuContext.Provider value={reducerBag}>\n      <OpenClosedProvider\n        value={match(menuState, {\n          [MenuStates.Open]: State.Open,\n          [MenuStates.Closed]: State.Closed,\n        })}\n      >\n        {render({ props, slot, defaultTag: DEFAULT_MENU_TAG, name: 'Menu' })}\n      </OpenClosedProvider>\n    </MenuContext.Provider>\n  )\n}\n\n// ---\n\nlet DEFAULT_BUTTON_TAG = 'button' as const\ninterface ButtonRenderPropArg {\n  open: boolean\n}\ntype ButtonPropsWeControl =\n  | 'id'\n  | 'type'\n  | 'aria-haspopup'\n  | 'aria-controls'\n  | 'aria-expanded'\n  | 'onKeyDown'\n  | 'onClick'\n\nlet Button = forwardRefWithAs(function Button<TTag extends ElementType = typeof DEFAULT_BUTTON_TAG>(\n  props: Props<TTag, ButtonRenderPropArg, ButtonPropsWeControl>,\n  ref: Ref<HTMLButtonElement>\n) {\n  let [state, dispatch] = useMenuContext([Menu.name, Button.name].join('.'))\n  let buttonRef = useSyncRefs(state.buttonRef, ref)\n\n  let id = `headlessui-menu-button-${useId()}`\n  let d = useDisposables()\n\n  let handleKeyDown = useCallback(\n    (event: ReactKeyboardEvent<HTMLButtonElement>) => {\n      switch (event.key) {\n        // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-13\n\n        case Keys.Space:\n        case Keys.Enter:\n        case Keys.ArrowDown:\n          event.preventDefault()\n          event.stopPropagation()\n          dispatch({ type: ActionTypes.OpenMenu })\n          d.nextFrame(() => dispatch({ type: ActionTypes.GoToItem, focus: Focus.First }))\n          break\n\n        case Keys.ArrowUp:\n          event.preventDefault()\n          event.stopPropagation()\n          dispatch({ type: ActionTypes.OpenMenu })\n          d.nextFrame(() => dispatch({ type: ActionTypes.GoToItem, focus: Focus.Last }))\n          break\n      }\n    },\n    [dispatch, d]\n  )\n\n  let handleKeyUp = useCallback((event: ReactKeyboardEvent<HTMLButtonElement>) => {\n    switch (event.key) {\n      case Keys.Space:\n        // Required for firefox, event.preventDefault() in handleKeyDown for\n        // the Space key doesn't cancel the handleKeyUp, which in turn\n        // triggers a *click*.\n        event.preventDefault()\n        break\n    }\n  }, [])\n\n  let handleClick = useCallback(\n    (event: ReactMouseEvent) => {\n      if (isDisabledReactIssue7711(event.currentTarget)) return event.preventDefault()\n      if (props.disabled) return\n      if (state.menuState === MenuStates.Open) {\n        dispatch({ type: ActionTypes.CloseMenu })\n        d.nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n      } else {\n        event.preventDefault()\n        event.stopPropagation()\n        dispatch({ type: ActionTypes.OpenMenu })\n      }\n    },\n    [dispatch, d, state, props.disabled]\n  )\n\n  let slot = useMemo<ButtonRenderPropArg>(() => ({ open: state.menuState === MenuStates.Open }), [\n    state,\n  ])\n  let passthroughProps = props\n  let propsWeControl = {\n    ref: buttonRef,\n    id,\n    type: useResolveButtonType(props, state.buttonRef),\n    'aria-haspopup': true,\n    'aria-controls': state.itemsRef.current?.id,\n    'aria-expanded': props.disabled ? undefined : state.menuState === MenuStates.Open,\n    onKeyDown: handleKeyDown,\n    onKeyUp: handleKeyUp,\n    onClick: handleClick,\n  }\n\n  return render({\n    props: { ...passthroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_BUTTON_TAG,\n    name: 'Menu.Button',\n  })\n})\n\n// ---\n\nlet DEFAULT_ITEMS_TAG = 'div' as const\ninterface ItemsRenderPropArg {\n  open: boolean\n}\ntype ItemsPropsWeControl =\n  | 'aria-activedescendant'\n  | 'aria-labelledby'\n  | 'id'\n  | 'onKeyDown'\n  | 'role'\n  | 'tabIndex'\n\nlet ItemsRenderFeatures = Features.RenderStrategy | Features.Static\n\nlet Items = forwardRefWithAs(function Items<TTag extends ElementType = typeof DEFAULT_ITEMS_TAG>(\n  props: Props<TTag, ItemsRenderPropArg, ItemsPropsWeControl> &\n    PropsForFeatures<typeof ItemsRenderFeatures>,\n  ref: Ref<HTMLDivElement>\n) {\n  let [state, dispatch] = useMenuContext([Menu.name, Items.name].join('.'))\n  let itemsRef = useSyncRefs(state.itemsRef, ref)\n\n  let id = `headlessui-menu-items-${useId()}`\n  let searchDisposables = useDisposables()\n\n  let usesOpenClosedState = useOpenClosed()\n  let visible = (() => {\n    if (usesOpenClosedState !== null) {\n      return usesOpenClosedState === State.Open\n    }\n\n    return state.menuState === MenuStates.Open\n  })()\n\n  useEffect(() => {\n    let container = state.itemsRef.current\n    if (!container) return\n    if (state.menuState !== MenuStates.Open) return\n    if (container === document.activeElement) return\n\n    container.focus({ preventScroll: true })\n  }, [state.menuState, state.itemsRef])\n\n  useTreeWalker({\n    container: state.itemsRef.current,\n    enabled: state.menuState === MenuStates.Open,\n    accept(node) {\n      if (node.getAttribute('role') === 'menuitem') return NodeFilter.FILTER_REJECT\n      if (node.hasAttribute('role')) return NodeFilter.FILTER_SKIP\n      return NodeFilter.FILTER_ACCEPT\n    },\n    walk(node) {\n      node.setAttribute('role', 'none')\n    },\n  })\n\n  let handleKeyDown = useCallback(\n    (event: ReactKeyboardEvent<HTMLDivElement>) => {\n      searchDisposables.dispose()\n\n      switch (event.key) {\n        // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-12\n\n        // @ts-expect-error Fallthrough is expected here\n        case Keys.Space:\n          if (state.searchQuery !== '') {\n            event.preventDefault()\n            event.stopPropagation()\n            return dispatch({ type: ActionTypes.Search, value: event.key })\n          }\n        // When in type ahead mode, fallthrough\n        case Keys.Enter:\n          event.preventDefault()\n          event.stopPropagation()\n          dispatch({ type: ActionTypes.CloseMenu })\n          if (state.activeItemIndex !== null) {\n            let { id } = state.items[state.activeItemIndex]\n            document.getElementById(id)?.click()\n          }\n          disposables().nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n          break\n\n        case Keys.ArrowDown:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToItem, focus: Focus.Next })\n\n        case Keys.ArrowUp:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToItem, focus: Focus.Previous })\n\n        case Keys.Home:\n        case Keys.PageUp:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToItem, focus: Focus.First })\n\n        case Keys.End:\n        case Keys.PageDown:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToItem, focus: Focus.Last })\n\n        case Keys.Escape:\n          event.preventDefault()\n          event.stopPropagation()\n          dispatch({ type: ActionTypes.CloseMenu })\n          disposables().nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n          break\n\n        case Keys.Tab:\n          event.preventDefault()\n          event.stopPropagation()\n          break\n\n        default:\n          if (event.key.length === 1) {\n            dispatch({ type: ActionTypes.Search, value: event.key })\n            searchDisposables.setTimeout(() => dispatch({ type: ActionTypes.ClearSearch }), 350)\n          }\n          break\n      }\n    },\n    [dispatch, searchDisposables, state]\n  )\n\n  let handleKeyUp = useCallback((event: ReactKeyboardEvent<HTMLButtonElement>) => {\n    switch (event.key) {\n      case Keys.Space:\n        // Required for firefox, event.preventDefault() in handleKeyDown for\n        // the Space key doesn't cancel the handleKeyUp, which in turn\n        // triggers a *click*.\n        event.preventDefault()\n        break\n    }\n  }, [])\n\n  let slot = useMemo<ItemsRenderPropArg>(() => ({ open: state.menuState === MenuStates.Open }), [\n    state,\n  ])\n  let propsWeControl = {\n    'aria-activedescendant':\n      state.activeItemIndex === null ? undefined : state.items[state.activeItemIndex]?.id,\n    'aria-labelledby': state.buttonRef.current?.id,\n    id,\n    onKeyDown: handleKeyDown,\n    onKeyUp: handleKeyUp,\n    role: 'menu',\n    tabIndex: 0,\n    ref: itemsRef,\n  }\n  let passthroughProps = props\n\n  return render({\n    props: { ...passthroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_ITEMS_TAG,\n    features: ItemsRenderFeatures,\n    visible,\n    name: 'Menu.Items',\n  })\n})\n\n// ---\n\nlet DEFAULT_ITEM_TAG = Fragment\ninterface ItemRenderPropArg {\n  active: boolean\n  disabled: boolean\n}\ntype MenuItemPropsWeControl =\n  | 'id'\n  | 'role'\n  | 'tabIndex'\n  | 'aria-disabled'\n  | 'onPointerLeave'\n  | 'onPointerMove'\n  | 'onMouseLeave'\n  | 'onMouseMove'\n  | 'onFocus'\n\nfunction Item<TTag extends ElementType = typeof DEFAULT_ITEM_TAG>(\n  props: Props<TTag, ItemRenderPropArg, MenuItemPropsWeControl> & {\n    disabled?: boolean\n    onClick?: (event: { preventDefault: Function }) => void\n  }\n) {\n  let { disabled = false, onClick, ...passthroughProps } = props\n  let [state, dispatch] = useMenuContext([Menu.name, Item.name].join('.'))\n  let id = `headlessui-menu-item-${useId()}`\n  let active = state.activeItemIndex !== null ? state.items[state.activeItemIndex].id === id : false\n\n  useIsoMorphicEffect(() => {\n    if (state.menuState !== MenuStates.Open) return\n    if (!active) return\n    let d = disposables()\n    d.nextFrame(() => document.getElementById(id)?.scrollIntoView?.({ block: 'nearest' }))\n    return d.dispose\n  }, [id, active, state.menuState])\n\n  let bag = useRef<MenuItemDataRef['current']>({ disabled })\n\n  useIsoMorphicEffect(() => {\n    bag.current.disabled = disabled\n  }, [bag, disabled])\n\n  useIsoMorphicEffect(() => {\n    bag.current.textValue = document.getElementById(id)?.textContent?.toLowerCase()\n  }, [bag, id])\n\n  useIsoMorphicEffect(() => {\n    dispatch({ type: ActionTypes.RegisterItem, id, dataRef: bag })\n    return () => dispatch({ type: ActionTypes.UnregisterItem, id })\n  }, [bag, id])\n\n  let handleClick = useCallback(\n    (event: MouseEvent) => {\n      if (disabled) return event.preventDefault()\n      dispatch({ type: ActionTypes.CloseMenu })\n      disposables().nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n      if (onClick) return onClick(event)\n    },\n    [dispatch, state.buttonRef, disabled, onClick]\n  )\n\n  let handleFocus = useCallback(() => {\n    if (disabled) return dispatch({ type: ActionTypes.GoToItem, focus: Focus.Nothing })\n    dispatch({ type: ActionTypes.GoToItem, focus: Focus.Specific, id })\n  }, [disabled, id, dispatch])\n\n  let handleMove = useCallback(() => {\n    if (disabled) return\n    if (active) return\n    dispatch({ type: ActionTypes.GoToItem, focus: Focus.Specific, id })\n  }, [disabled, active, id, dispatch])\n\n  let handleLeave = useCallback(() => {\n    if (disabled) return\n    if (!active) return\n    dispatch({ type: ActionTypes.GoToItem, focus: Focus.Nothing })\n  }, [disabled, active, dispatch])\n\n  let slot = useMemo<ItemRenderPropArg>(() => ({ active, disabled }), [active, disabled])\n  let propsWeControl = {\n    id,\n    role: 'menuitem',\n    tabIndex: disabled === true ? undefined : -1,\n    'aria-disabled': disabled === true ? true : undefined,\n    disabled: undefined, // Never forward the `disabled` prop\n    onClick: handleClick,\n    onFocus: handleFocus,\n    onPointerMove: handleMove,\n    onMouseMove: handleMove,\n    onPointerLeave: handleLeave,\n    onMouseLeave: handleLeave,\n  }\n\n  return render({\n    props: { ...passthroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_ITEM_TAG,\n    name: 'Menu.Item',\n  })\n}\n\n// ---\n\nMenu.Button = Button\nMenu.Items = Items\nMenu.Item = Item\n"]},"metadata":{},"sourceType":"module"}